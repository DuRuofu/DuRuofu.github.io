

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="https://image-1308319148.cos.ap-chengdu.myqcloud.com/main/%E4%B8%AA%E4%BA%BA%E5%A4%B4%E5%83%8F%E6%97%A0%E8%83%8C%E6%99%AF.png">
  <link rel="icon" href="https://image-1308319148.cos.ap-chengdu.myqcloud.com/main/%E4%B8%AA%E4%BA%BA%E5%A4%B4%E5%83%8F%E6%97%A0%E8%83%8C%E6%99%AF.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="DuRuofu">
  <meta name="keywords" content="嵌入式,个人博客,个人测试">
  
    <meta name="description" content="本文是复习笔记，记录feeeRTOS的基本概念和使用">
<meta property="og:type" content="article">
<meta property="og:title" content="FreeRTOS复习笔记">
<meta property="og:url" content="https://www.duruofu.xyz/posts/58683/index.html">
<meta property="og:site_name" content="Duruofu&#39;s 个人测试">
<meta property="og:description" content="本文是复习笔记，记录feeeRTOS的基本概念和使用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.duruofu.xyz/img/index_img/freertos.png">
<meta property="article:published_time" content="2024-12-30T03:21:53.000Z">
<meta property="article:modified_time" content="2025-01-11T15:16:15.859Z">
<meta property="article:author" content="DuRuofu">
<meta property="article:tag" content="FreeRTOS">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.duruofu.xyz/img/index_img/freertos.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>FreeRTOS复习笔记 - Duruofu&#39;s 个人测试</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/cust/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.duruofu.xyz","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":80,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":true,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":5},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null},"gtag":null,"woyaola":null,"cnzz":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>DuRuofu</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/2020/06/06/1.%E9%98%85%E8%AF%BB%E5%86%99%E4%BD%9C/%E5%8E%9F%E5%88%9B%E8%AF%97%E8%AF%8D/%E8%AF%97%E8%AF%8D/" target="_self">
                <i class="iconfont icon-books"></i>
                <span>诗词</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>ESP32教程</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/58874/" target="_self">
                    
                    <span>ESP32教程-2024</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/58875/" target="_self">
                    
                    <span>ESP32教程-2025</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="FreeRTOS复习笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        DuRuofu
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-30 11:21" pubdate>
          2024年12月30日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          28 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">FreeRTOS复习笔记</h1>
            
              <p id="updated-time" class="note note-info" style="display: none">
                
                  
                    本文最后更新于 2025-01-11T23:16:15+08:00
                  
                  

                
              </p>
            
            
              <div class="markdown-body">
                
                <table>
<thead>
<tr>
<th>文档名称</th>
<th>版本</th>
<th>作者</th>
<th>时间</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>FreeRTOS</td>
<td>v1.0.0</td>
<td>DuRuofu</td>
<td>2024-12-30</td>
<td>首次建立</td>
</tr>
</tbody></table>
<div STYLE="page-break-after: always;"></div>

<blockquote>
<p>备注：</p>
<ol>
<li>笔记中的代码使用ESP-IDF 5.3版本，与标准的FreeRTOSAPI可能稍有偏差</li>
<li>笔记复制了很多他人帖子里的图片和文段（链接位于文末），仅用于个人学习使用。</li>
</ol>
</blockquote>
<h1 id="一、FreeRTOS是什么？"><a href="#一、FreeRTOS是什么？" class="headerlink" title="一、FreeRTOS是什么？"></a>一、FreeRTOS是什么？</h1><p>官网文档：<a target="_blank" rel="noopener" href="https://www.freertos.org/zh-cn-cmn-s/Documentation/01-FreeRTOS-quick-start/01-Beginners-guide/01-RTOS-fundamentals">https://www.freertos.org/zh-cn-cmn-s/Documentation/01-FreeRTOS-quick-start/01-Beginners-guide/01-RTOS-fundamentals</a></p>
<h2 id="1-1-RTOS是什么"><a href="#1-1-RTOS是什么" class="headerlink" title="1.1 RTOS是什么?"></a>1.1 RTOS是什么?</h2><p>实时操作系统 (RTOS) 是一种体积小巧、确定性强的计算机操作系统。 RTOS 通常用于需要在严格时间限制内对外部事件做出反应的嵌入式系统，如医疗设备和汽车电子控制单元 (ECU)。 通常，此类嵌入式系统中只有一两项功能需要确定性时序，即使嵌入式系统不需要严格的实时反应，使用 RTOS 仍能提供诸多优势。RTOS 通常比通用操作系统体积更小、重量更轻，因此 RTOS 非常适用于 内存、计算和功率受限的设备。</p>
<h2 id="1-2-与裸机的对比"><a href="#1-2-与裸机的对比" class="headerlink" title="1.2 与裸机的对比"></a>1.2 与裸机的对比</h2><h3 id="1-裸机："><a href="#1-裸机：" class="headerlink" title="1. 裸机："></a>1. 裸机：</h3><p>在裸机系统中，所有的操作都是在一个无限的大循环里面实现,支持中断检测。外部中断紧急事件在中断里面标记或者响应，中断服务称为前台，main 函数里面的while(1)无限循环称为后台，按顺序处理业务功能，以及中断标记的可执行的事件。小型的电子产品用的都是裸机系统，而且也能够满足需求。但当程序复杂之后，这样的裸机程序难以阅读和维护。<br><img src="/posts/58683/20250111224625.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-RTOS："><a href="#2-RTOS：" class="headerlink" title="2. RTOS："></a>2. RTOS：</h3><p>在实时操作系统中，我们可以把要实现的功能划分为多个任务，每个任务负责实现其中的一部分，每个任务都是一个很简单的程序，通常是一个死循环。 RTOS操作系统的核心内容在于：实时内核。</p>
<p>RTOS的内核负责管理所有的任务，内核决定了运行哪个任务，何时停止当前任务切换到其他任务，这个是内核的多任务管理能力。多任务管理给人的感觉就好像芯片有多个CPU，多任务管理实现了CPU资源的最大化利用，多任务管理有助于实现程序的模块化开发，能够实现复杂的实时应用。可剥夺内核顾名思义就是可以剥夺其他任务的CPU使用权，它总是运行就绪任务中的优先级最高的那个任务。</p>
<p>加入操作系统后，开发人员不需要关注每个功能模块之间的冲突，重心放在子程序的实现。缺点是整个系统随之带来的额外RAM开销，但对目前的单片机的来影响不大。</p>
<p><img src="/posts/58683/20250111224634.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="1-3-RTOS多任务处理与并发的实现"><a href="#1-3-RTOS多任务处理与并发的实现" class="headerlink" title="1.3 RTOS多任务处理与并发的实现"></a>1.3 RTOS多任务处理与并发的实现</h2><p>常规单核处理器一次只能执行一个任务，但多任务操作系统可以快速切换任务， 使所有任务看起来像是同时在执行。</p>
<p><img src="/posts/58683/20250104213820.png" srcset="/img/loading.gif" lazyload></p>
<p>切换的过程由<strong>任务调度器</strong>实现，任务调度器就是使用相关的调度算法来决定当前需要执行的哪个任务。</p>
<p>FreeRTOS一共支持三种任务调度方式：</p>
<ul>
<li><strong>抢占式调度</strong> ：主要是针对优先级不同的任务，每一个任务都有一个任务优先级，优先级高的任务可以抢占低优先级的任务的CPU使用权。</li>
<li><strong>时间片调度</strong> ：主要针对相同优先级的任务，当多个任务的优先级相同时，任务调度器会在每个时钟节拍到来的时候切换任务。</li>
<li><strong>协程式调度</strong> ：其实就是轮询，当前执行任务将会一直运行，同时高优先级的任务不会抢占低优先级任务。FreeRTOS现在虽然还在支持，但官方已经明确表示不再更新协程式调度。</li>
</ul>
<p>总的来说：</p>
<ol>
<li>高优先级任务，优先执行。</li>
<li>高优先级任务不停止，低优先级任务无法执行。</li>
<li>被抢占的任务将会进去就绪态。</li>
</ol>
<h2 id="1-4-相关概念"><a href="#1-4-相关概念" class="headerlink" title="1.4 相关概念"></a>1.4 相关概念</h2><h3 id="时间片："><a href="#时间片：" class="headerlink" title="时间片："></a>时间片：</h3><p>同等优先级任务轮流享有相同的CPU时间(可设置)，叫做时间片，在FreeRTOS中，一个时间片等于SysTick中断周期。</p>
<h3 id="队列："><a href="#队列：" class="headerlink" title="队列："></a>队列：</h3><p>队列是一种只允许在表的前端（front）进行删除操作，而在表的后端（rear）进行插入操作。队尾放入数据，对头挤出。先进先出，称为FIFO</p>
<h3 id="任务："><a href="#任务：" class="headerlink" title="任务："></a>任务：</h3><p>在裸机系统中，系统的主体就是 main 函数里面顺序执行的无限循环，这个无限循环里面 CPU 按照顺序完成各种事情。在多任务系统中，根据功能的不同，把整个系统分割成一个个独立的且无法返回的函数，这个函数我们称为任务。系统中的每一任务都有多种运行状态。系统初始化完成后，创建的任务就可以在系统中竞争一定的资源，由内核进行调度。</p>
<p><img src="/posts/58683/20250106204735.png" srcset="/img/loading.gif" lazyload></p>
<p>任务可以存在于以下状态中：</p>
<ul>
<li><strong>运行</strong><br>当任务实际执行时，它被称为处于运行状态。任务当前正在使用处理器。 如果运行 RTOS 的处理器只有一个内核， 那么在任何给定时间内都只能有一个任务处于运行状态。</li>
<li><strong>准备就绪</strong><br>准备就绪任务指那些能够执行（它们不处于阻塞或挂起状态）， 但目前没有执行的任务， 因为同等或更高优先级的不同任务已经处于运行状态。</li>
<li><strong>阻塞</strong><br>如果任务当前正在等待时间或外部事件，则该任务被认为处于阻塞状态。 例如，如果一个任务调用vTaskDelay()，它将被阻塞（被置于阻塞状态）， 直到延迟结束——一个时间事件。 任务也可以通过阻塞来等待队列、信号量、事件组、通知或信号量 事件。处于阻塞状态的任务通常有一个”超时”期， 超时后任务将被超时，并被解除阻塞， 即使该任务所等待的事件没有发生。“阻塞”状态下的任务不使用任何处理时间，不能 被选择进入运行状态。</li>
<li><strong>挂起</strong><br>与“阻塞”状态下的任务一样， “挂起”状态下的任务不能 被选择进入运行状态，但处于挂起状态的任务 没有超时。相反，任务只有在分别通过 vTaskSuspend() 和 xTaskResume() API 调用明确命令时 才会进入或退出挂起状态。</li>
</ul>
<h3 id="临界区："><a href="#临界区：" class="headerlink" title="临界区："></a>临界区：</h3><p>临界区就是一段在执行的时候不能被中断的代码段。在多任务操作系统里面，对全局变量的操作不能被打断，不能执行到一半就被其他任务再次操作。一般被打断，原因就是系统调度或外部中断。对临界区的保护控制，归根到底就是对系统中断的使能控制。<br>在使用临界区时，关闭中断响应，对部分优先级的中断进行屏蔽，因此临界区不允许运行时间过长。为了对临界区进行控制，就需要使用信号量通信，实现同步或互斥操作。</p>
<h1 id="二、FreeRTOS多任务管理"><a href="#二、FreeRTOS多任务管理" class="headerlink" title="二、FreeRTOS多任务管理"></a>二、FreeRTOS多任务管理</h1><h2 id="2-1-创建任务"><a href="#2-1-创建任务" class="headerlink" title="2.1 创建任务"></a><a target="_blank" rel="noopener" href="https://www.freertos.org/zh-cn-cmn-s/Documentation/02-Kernel/04-API-references/01-Task-creation/00-TaskHandle">2.1 创建任务</a></h2><h3 id="2-1-1-API说明："><a href="#2-1-1-API说明：" class="headerlink" title="2.1.1 API说明："></a>2.1.1 API说明：</h3><p>创建任务涉及三个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>动态&#x2F;静态</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>xTaskCreate</code></td>
<td>动态创建任务</td>
<td>动态</td>
<td></td>
</tr>
<tr>
<td><code>xTaskCreateStatic</code></td>
<td>静态创建任务</td>
<td>静态</td>
<td></td>
</tr>
<tr>
<td><code>xTaskCreateRestrictedStatic</code></td>
<td>静态创建受限任务（权限控制）</td>
<td>静态</td>
<td>很少用</td>
</tr>
<tr>
<td>下面是对各个API的详细解释：</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="xTaskCreate-动态创建一个任务"><a href="#xTaskCreate-动态创建一个任务" class="headerlink" title="xTaskCreate : 动态创建一个任务"></a>xTaskCreate : 动态创建一个任务</h4><p>当需要在运行时动态分配内存来创建任务时使用，也就是一般的正常情况。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTaskCreate</span><span class="hljs-params">( TaskFunction_t pvTaskCode,</span><br><span class="hljs-params">                        <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span> pcName,</span><br><span class="hljs-params">                        <span class="hljs-type">const</span> configSTACK_DEPTH_TYPE uxStackDepth,</span><br><span class="hljs-params">                        <span class="hljs-type">void</span> *pvParameters,</span><br><span class="hljs-params">                        UBaseType_t uxPriority,</span><br><span class="hljs-params">                        TaskHandle_t *pxCreatedTask</span><br><span class="hljs-params">                      )</span>;<br></code></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li><code>pvTaskCode</code>：任务函数的入口地址。</li>
<li><code>pcName</code>：任务名称（用于调试）。</li>
<li><code>usStackDepth</code>：任务栈大小（以字为单位）。</li>
<li><code>pvParameters</code>：传递给任务函数的参数。</li>
<li><code>uxPriority</code>：任务的优先级（数字越大优先级越大）。</li>
<li><code>pxCreatedTask</code>：存储任务句柄（可选）。</li>
</ul>
<p>返回值:</p>
<ul>
<li><code>pdPASS</code>：任务创建成功。</li>
<li><code>errCOULD_NOT_ALLOCATE_REQUIRED_MEMORY</code>：任务创建失败（内存不足）</li>
</ul>
<h4 id="xTaskCreateStatic：静态创建一个任务"><a href="#xTaskCreateStatic：静态创建一个任务" class="headerlink" title="xTaskCreateStatic：静态创建一个任务"></a>xTaskCreateStatic：静态创建一个任务</h4><p>手动提供任务栈和任务控制块（TCB），避免动态内存分配。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">TaskHandle_t <span class="hljs-title function_">xTaskCreateStatic</span><span class="hljs-params">(</span><br><span class="hljs-params">    TaskFunction_t pvTaskCode,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span> pcName,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> ulStackDepth,</span><br><span class="hljs-params">    <span class="hljs-type">void</span> * <span class="hljs-type">const</span> pvParameters,</span><br><span class="hljs-params">    UBaseType_t uxPriority,</span><br><span class="hljs-params">    StackType_t * <span class="hljs-type">const</span> puxStackBuffer,</span><br><span class="hljs-params">    StaticTask_t * <span class="hljs-type">const</span> pxTaskBuffer</span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数：</strong></p>
<ul>
<li><code>pvTaskCode</code>：任务函数的入口地址。</li>
<li><code>pcName</code>：任务名称（用于调试）。</li>
<li><code>usStackDepth</code>：任务栈大小（以字为单位）。</li>
<li><code>pvParameters</code>：传递给任务函数的参数。</li>
<li><code>uxPriority</code>：任务的优先级。</li>
<li><code>puxStackBuffer</code>：指向任务栈缓冲区的指针（由用户提供）。</li>
<li><code>pxTaskBuffer</code>：指向任务控制块的缓冲区（由用户提供）。</li>
</ul>
<p><strong>返回值:</strong></p>
<ul>
<li><code>pdPASS</code>：任务创建成功。</li>
<li><code>errCOULD_NOT_ALLOCATE_REQUIRED_MEMORY</code>：任务创建失败（内存不足）</li>
</ul>
<h4 id="xTaskCreateRestrictedStatic：为受限任务（restricted-task）创建任务"><a href="#xTaskCreateRestrictedStatic：为受限任务（restricted-task）创建任务" class="headerlink" title="xTaskCreateRestrictedStatic：为受限任务（restricted task）创建任务"></a>xTaskCreateRestrictedStatic：为受限任务（restricted task）创建任务</h4><p>用于创建特定权限的任务，一般用于内存保护单元（MPU）配置中，限制任务的访问权限。</p>
<p>原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">TaskHandle_t <span class="hljs-title function_">xTaskCreateRestrictedStatic</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-type">const</span> TaskParameters_t * <span class="hljs-type">const</span> pxTaskDefinition,</span><br><span class="hljs-params">    StackType_t * <span class="hljs-type">const</span> puxStackBuffer,</span><br><span class="hljs-params">    StaticTask_t * <span class="hljs-type">const</span> pxTaskBuffer</span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>pxTaskDefinition</code>：任务参数定义结构（包含任务入口、名称、栈大小、优先级等）。</li>
<li><code>puxStackBuffer</code>：栈的静态缓冲区。</li>
<li><code>pxTaskBuffer</code>：任务控制块的静态缓冲区。</li>
</ul>
<p>返回值：任务句柄。</p>
<h3 id="2-1-2-创建任务示例代码："><a href="#2-1-2-创建任务示例代码：" class="headerlink" title="2.1.2 创建任务示例代码："></a>2.1.2 创建任务示例代码：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 任务函数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">myTask</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>	<span class="hljs-keyword">for</span> (;;)<br>	&#123;<br>		vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>		ESP_LOGI(TAG, <span class="hljs-string">&quot;myTask&quot;</span>);<br>	&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>	<span class="hljs-comment">// 创建一个 FreeRTOS 任务</span><br>	<span class="hljs-comment">// 参数说明：</span><br>	<span class="hljs-comment">// 1. 任务入口函数：myTask</span><br>	<span class="hljs-comment">// 2. 任务名称：&quot;myTask&quot;，用于调试时标识任务</span><br>	<span class="hljs-comment">// 3. 任务堆栈大小：2048 字节（适当分配以避免栈溢出）</span><br>	<span class="hljs-comment">// 4. 任务参数：NULL（未传递参数）</span><br>	<span class="hljs-comment">// 5. 任务优先级：1（优先级较低，空闲任务优先级为 0）</span><br>	<span class="hljs-comment">// 6. 任务句柄：NULL（不需要保存任务句柄）</span><br>	xTaskCreate(myTask, <span class="hljs-string">&quot;myTask&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="2-2-FreeRTOS删除任务"><a href="#2-2-FreeRTOS删除任务" class="headerlink" title="2.2  FreeRTOS删除任务"></a>2.2  <a target="_blank" rel="noopener" href="https://www.freertos.org/zh-cn-cmn-s/Documentation/02-Kernel/04-API-references/01-Task-creation/00-TaskHandle">FreeRTOS删除任务</a></h2><h3 id="2-2-1-API说明："><a href="#2-2-1-API说明：" class="headerlink" title="2.2.1 API说明："></a>2.2.1 API说明：</h3><p>删除任务涉及一个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>动态&#x2F;静态</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>vTaskDelete</code></td>
<td>删除任务</td>
<td>动态&#x2F;静态</td>
<td>可以删除别的任务，也可以自我删除</td>
</tr>
<tr>
<td>下面是对各个API的详细解释：</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="vTaskDelete：删除一个任务"><a href="#vTaskDelete：删除一个任务" class="headerlink" title="vTaskDelete：删除一个任务"></a>vTaskDelete：删除一个任务</h4><p>当任务完成其功能后，需要释放资源，或当系统需要动态调整任务时使用<br>注意：调用后，任务进入删除 状态，但动态分配的内存需要由 FreeRTOS 自动释放。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskDelete</span><span class="hljs-params">( TaskHandle_t xTask )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xTask：要删除的任务句柄。如果传递 NULL，则删除当前任务。</li>
</ul>
<h3 id="2-2-2-示例代码："><a href="#2-2-2-示例代码：" class="headerlink" title="2.2.2 示例代码："></a>2.2.2 示例代码：</h3><h4 id="1-删除别人"><a href="#1-删除别人" class="headerlink" title="1. 删除别人"></a>1. 删除别人</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 任务函数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">myTask</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        vTaskDelay(<span class="hljs-number">500</span> / portTICK_PERIOD_MS);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;myTask&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 任务句柄</span><br>    TaskHandle_t taskHandle = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-comment">// 创建一个 FreeRTOS 任务</span><br>    xTaskCreate(myTask, <span class="hljs-string">&quot;myTask&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, &amp;taskHandle);<br><br>    vTaskDelay(<span class="hljs-number">2000</span> / portTICK_PERIOD_MS);<br><br>    <span class="hljs-comment">// 删除任务</span><br>    <span class="hljs-keyword">if</span> (taskHandle != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        vTaskDelete(taskHandle);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="2-自我删除"><a href="#2-自我删除" class="headerlink" title="2. 自我删除"></a>2. 自我删除</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 任务函数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">myTask</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;myTask:1&quot;</span>);<br>    vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;myTask:2&quot;</span>);<br>    vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;myTask:3&quot;</span>);<br><br>    <span class="hljs-comment">// 删除任务(如果传递 NULL，则删除当前任务)</span><br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 任务句柄</span><br>    TaskHandle_t taskHandle = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-comment">// 创建一个 FreeRTOS 任务</span><br>    xTaskCreate(myTask, <span class="hljs-string">&quot;myTask&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, &amp;taskHandle);<br>&#125;<br><br></code></pre></td></tr></table></figure>


<h2 id="2-3-任务创建时传递参数"><a href="#2-3-任务创建时传递参数" class="headerlink" title="2.3 任务创建时传递参数"></a>2.3 任务创建时传递参数</h2><h3 id="2-3-1-说明："><a href="#2-3-1-说明：" class="headerlink" title="2.3.1 说明："></a>2.3.1 说明：</h3><p>在 FreeRTOS 中，任务函数的参数通过创建任务时的 pvParameters 指针传递。pvParameters 是一个 void * 类型的指针，可以传递任意类型的数据（整型、数组、结构体或字符串等）。任务接收到参数后，需要将其强制类型转换为对应的数据类型，以便正确使用。</p>
<p><img src="/posts/58683/20250110155751.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-3-2-示例："><a href="#2-3-2-示例：" class="headerlink" title="2.3.2 示例："></a>2.3.2 示例：</h3><p>示例为传递四种参数，分别是整型参数，数组参数，结构体参数，字符串参数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int</span> Int;<br>    <span class="hljs-type">int</span> Array[<span class="hljs-number">3</span>];<br>&#125; MyStruct;<br><br><span class="hljs-comment">// 任务函数1:接收整型参数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-type">int</span> *pInt = (<span class="hljs-type">int</span> *)pvParameters;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;取得整型参数为：%d&quot;</span>, *pInt);<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-comment">// 任务函数2:接收数组参数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-type">int</span> *pArray = (<span class="hljs-type">int</span> *)pvParameters;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;取得数组参数为：%d %d %d&quot;</span>, *pArray, *(pArray + <span class="hljs-number">1</span>), *(pArray + <span class="hljs-number">2</span>));<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-comment">// 任务函数3:接收结构体参数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    MyStruct *pStruct = (MyStruct *)pvParameters;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;取得结构体参数为：%d %d %d %d&quot;</span>, pStruct-&gt;Int, pStruct-&gt;Array[<span class="hljs-number">0</span>], pStruct-&gt;Array[<span class="hljs-number">1</span>], pStruct-&gt;Array[<span class="hljs-number">2</span>]);<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-comment">// 任务函数4:接收字符串参数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_4</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-type">char</span> *pChar = (<span class="hljs-type">char</span> *)pvParameters;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;取得字符串参数为：%s&quot;</span>, pChar);<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">int</span> Parameters_1 = <span class="hljs-number">1</span>;<br><span class="hljs-type">int</span> Parameters_2[<span class="hljs-number">3</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br>MyStruct Parameters_3 = &#123;<span class="hljs-number">1</span>, &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;&#125;;<br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *Parameters_4 = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 传递整形参数</span><br>    xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">2048</span>, (<span class="hljs-type">void</span> *)&amp;Parameters_1, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-comment">// 传递数组参数</span><br>    xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_2&quot;</span>, <span class="hljs-number">2048</span>, (<span class="hljs-type">void</span> *)&amp;Parameters_2, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-comment">// 传递结构体参数</span><br>    xTaskCreate(Task_3, <span class="hljs-string">&quot;Task_3&quot;</span>, <span class="hljs-number">3048</span>, (<span class="hljs-type">void</span> *)&amp;Parameters_3, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-comment">// 传递字符串参数(注意这里没有取地址符号&amp;)</span><br>    xTaskCreate(Task_4, <span class="hljs-string">&quot;Task_4&quot;</span>, <span class="hljs-number">3048</span>, (<span class="hljs-type">void</span> *)Parameters_4, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2-4-FreeRTOS任务优先级"><a href="#2-4-FreeRTOS任务优先级" class="headerlink" title="2.4 FreeRTOS任务优先级"></a>2.4 FreeRTOS任务优先级</h2><p>FreeRTOS 中每个任务都有一个优先级，优先级决定了任务的执行顺序。优先级数值较大的任务具有更高的优先级，会在低优先级任务之前被调度执行。当多个任务具有相同优先级时，调度器会使用时间片轮转机制在这些任务之间分配 CPU 时间。</p>
<h3 id="2-4-1-API说明："><a href="#2-4-1-API说明：" class="headerlink" title="2.4.1 API说明："></a>2.4.1 API说明：</h3><p>任务优先级涉及以下两个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>uxTaskPriorityGet</code></td>
<td>获取任务的当前优先级</td>
<td>返回任务的优先级</td>
</tr>
<tr>
<td><code>vTaskPrioritySet</code></td>
<td>设置任务的优先级</td>
<td>设置指定任务的优先级</td>
</tr>
</tbody></table>
<h4 id="uxTaskPriorityGet：获取任务的优先级"><a href="#uxTaskPriorityGet：获取任务的优先级" class="headerlink" title="uxTaskPriorityGet：获取任务的优先级"></a>uxTaskPriorityGet：获取任务的优先级</h4><p>该函数用于获取指定任务的当前优先级。如果任务句柄为 <code>NULL</code>，则返回当前任务的优先级。<br><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">UBaseType_t <span class="hljs-title function_">uxTaskPriorityGet</span><span class="hljs-params">( TaskHandle_t xTask )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xTask：任务句柄。如果为 NULL，则返回当前任务的优先级。</li>
</ul>
<p><strong>返回值：</strong>任务的优先级。</p>
<h4 id="vTaskPrioritySet：设置任务的优先级"><a href="#vTaskPrioritySet：设置任务的优先级" class="headerlink" title="vTaskPrioritySet：设置任务的优先级"></a>vTaskPrioritySet：设置任务的优先级</h4><p>该函数用于设置指定任务的优先级。如果任务句柄为 NULL，则设置当前任务的优先级.<br><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskPrioritySet</span><span class="hljs-params">( TaskHandle_t xTask, UBaseType_t uxPriority )</span>;<br><br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xTask：任务句柄。如果为 NULL，则设置当前任务的优先级。</li>
<li>uxPriority：要设置的优先级值。</li>
</ul>
<h3 id="2-4-2-示例代码"><a href="#2-4-2-示例代码" class="headerlink" title="2.4.2 示例代码"></a>2.4.2 示例代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    UBaseType_t taskPriority_1 = <span class="hljs-number">0</span>;<br>    UBaseType_t taskPriority_2 = <span class="hljs-number">0</span>;<br>    TaskHandle_t taskHandle_1 = <span class="hljs-literal">NULL</span>;<br>    TaskHandle_t taskHandle_2 = <span class="hljs-literal">NULL</span>;<br>    <br>    xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">12</span>, &amp;taskHandle_1);<br>    taskPriority_1 = uxTaskPriorityGet(taskHandle_1);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;Task_1 优先级：%d&quot;</span>, taskPriority_1);<br><br>    xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">12</span>, &amp;taskHandle_2);<br>    taskPriority_2 = uxTaskPriorityGet(taskHandle_2);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;Task_1 优先级：%d&quot;</span>, taskPriority_2);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-5-FreeRTOS任务挂起"><a href="#2-5-FreeRTOS任务挂起" class="headerlink" title="2.5 FreeRTOS任务挂起"></a>2.5 FreeRTOS任务挂起</h2><p>FreeRTOS 任务挂起是指暂停任务的执行，直到通过显式恢复操作再次启动任务。挂起操作不会影响任务所占用的资源，仅是暂停任务调度。</p>
<p><img src="/posts/58683/20250106204735.png" srcset="/img/loading.gif" lazyload></p>
<p>任务可以存在于以下状态中：</p>
<ul>
<li><strong>运行</strong><br>当任务实际执行时，它被称为处于运行状态。任务当前正在使用处理器。 如果运行 RTOS 的处理器只有一个内核， 那么在任何给定时间内都只能有一个任务处于运行状态。</li>
<li><strong>准备就绪</strong><br>准备就绪任务指那些能够执行（它们不处于阻塞或挂起状态）， 但目前没有执行的任务， 因为同等或更高优先级的不同任务已经处于运行状态。</li>
<li><strong>阻塞</strong><br>如果任务当前正在等待时间或外部事件，则该任务被认为处于阻塞状态。 例如，如果一个任务调用vTaskDelay()，它将被阻塞（被置于阻塞状态）， 直到延迟结束——一个时间事件。 任务也可以通过阻塞来等待队列、信号量、事件组、通知或信号量 事件。处于阻塞状态的任务通常有一个”超时”期， 超时后任务将被超时，并被解除阻塞， 即使该任务所等待的事件没有发生。“阻塞”状态下的任务不使用任何处理时间，不能 被选择进入运行状态。</li>
<li><strong>挂起</strong><br>与“阻塞”状态下的任务一样， “挂起”状态下的任务不能 被选择进入运行状态，但处于挂起状态的任务 没有超时。相反，任务只有在分别通过 vTaskSuspend() 和 xTaskResume() API 调用明确命令时 才会进入或退出挂起状态。</li>
</ul>
<h3 id="2-5-1-API说明："><a href="#2-5-1-API说明：" class="headerlink" title="2.5.1 API说明："></a>2.5.1 API说明：</h3><p>任务挂起涉及以下两个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>vTaskSuspend</code></td>
<td>挂起任务</td>
<td>将指定任务挂起</td>
</tr>
<tr>
<td><code>xTaskResume</code></td>
<td>恢复任务</td>
<td>恢复指定任务的执行</td>
</tr>
</tbody></table>
<h4 id="vTaskSuspend：挂起任务"><a href="#vTaskSuspend：挂起任务" class="headerlink" title="vTaskSuspend：挂起任务"></a>vTaskSuspend：挂起任务</h4><p><code>vTaskSuspend()</code> 用于挂起指定任务，任务被挂起后无法再执行，直到通过 <code>xTaskResume()</code> 恢复任务。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskSuspend</span><span class="hljs-params">(TaskHandle_t xTask)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xTask：要挂起的任务句柄。如果传递 NULL，则挂起当前任务。</li>
</ul>
<h4 id="xTaskResume：恢复任务"><a href="#xTaskResume：恢复任务" class="headerlink" title="xTaskResume：恢复任务"></a>xTaskResume：恢复任务</h4><p>用于恢复一个挂起的任务。恢复任务后，任务重新进入准备就绪状态，等待调度器调度。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTaskResume</span><span class="hljs-params">(TaskHandle_t xTask)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xTask：要恢复的任务句柄。如果传递 NULL，则恢复当前任务。</li>
</ul>
<h3 id="2-5-2-示例代码："><a href="#2-5-2-示例代码：" class="headerlink" title="2.5.2 示例代码："></a>2.5.2 示例代码：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br>TaskHandle_t taskHandle_1 = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-comment">// 任务1：定时打印日志</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1正在运行...&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>)); <span class="hljs-comment">// 延迟1秒</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 任务2：控制任务1的挂起与恢复</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;挂起任务1...&quot;</span>);<br>        vTaskSuspend(taskHandle_1); <span class="hljs-comment">// 挂起任务1</span><br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>)); <span class="hljs-comment">// 延迟5秒</span><br><br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;恢复任务1...&quot;</span>);<br>        vTaskResume(taskHandle_1); <span class="hljs-comment">// 恢复任务1</span><br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>)); <span class="hljs-comment">// 再延迟5秒</span><br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 创建任务1</span><br>    xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">5</span>, &amp;taskHandle_1);<br>    <span class="hljs-comment">// 创建任务2</span><br>    xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_2&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">5</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-6-系统任务信息显示"><a href="#2-6-系统任务信息显示" class="headerlink" title="2.6 系统任务信息显示"></a>2.6 系统任务信息显示</h2><p>FreeRTOS 提供了多种方法来显示和分析任务信息，帮助开发者了解系统运行状况、优化性能以及定位问题。</p>
<p>系统任务信息显示主要有以下两个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><code>vTaskList</code></td>
<td>输出任务列表</td>
<td>需开启配置才能使用</td>
</tr>
<tr>
<td><code>uxTaskGetStackHighWaterMark</code></td>
<td>获取任务最小剩余栈空间</td>
<td>需开启配置才能使用</td>
</tr>
</tbody></table>
<h3 id="2-6-1-API介绍"><a href="#2-6-1-API介绍" class="headerlink" title="2.6.1 API介绍"></a>2.6.1 API介绍</h3><h4 id="vTaskList-输出任务列表"><a href="#vTaskList-输出任务列表" class="headerlink" title="vTaskList: 输出任务列表"></a>vTaskList: 输出任务列表</h4><p>可通过 <code>vTaskList()</code> 来协助分析操作系统当前 task 状态，以帮助优化内存，帮助定位栈溢出问题，帮助理解和学习操作系统原理相关知识。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskList</span><span class="hljs-params">( <span class="hljs-type">char</span> *pcWriteBuffer )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>注意：</strong><code>configUSE_TRACE_FACILITY</code>和<code>configUSE_STATS_FORMATTING_FUNCTIONS</code>必须在 FreeRTOSConfig.h 中定义为 1，才可使用此函数。<br>对于ESP32来说。使用 vTaskList() 前需使能:</p>
<p>menuconfig -&gt; Component config -&gt; FreeRTOS -&gt; Kernel-&gt;<code>configUSE_TRACE_FACILITY</code><br>menuconfig -&gt; Component config -&gt; FreeRTOS -&gt; Kernel-&gt;<code>configUSE_STATS_FORMATTING_FUNCTIONS</code></p>
<p>如下图：</p>
<p><img src="/posts/58683/20250106231616.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="uxTaskGetStackHighWaterMark-获取任务最小剩余栈空间"><a href="#uxTaskGetStackHighWaterMark-获取任务最小剩余栈空间" class="headerlink" title="uxTaskGetStackHighWaterMark:获取任务最小剩余栈空间"></a>uxTaskGetStackHighWaterMark:获取任务最小剩余栈空间</h4><p>用于获取任务在运行期间的最小剩余栈空间（即栈的高水位标记）。此函数可帮助检测任务是否存在栈溢出的风险。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">UBaseType_t <span class="hljs-title function_">uxTaskGetStackHighWaterMark</span><span class="hljs-params">( TaskHandle_t xTask )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数：</strong></p>
<ul>
<li>xTask：任务句柄。如果传递 NULL，则返回当前任务的栈高水位标记。</li>
</ul>
<p><strong>返回值：</strong> 剩余栈空间的字数（单位为字）,(但是在ESP-IDF里为字节)</p>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;Task_1&quot;</span>);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;Task_2&quot;</span>);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    TaskHandle_t taskHandle_1 = <span class="hljs-literal">NULL</span>;<br>    TaskHandle_t taskHandle_2 = <span class="hljs-literal">NULL</span>;<br>    <br>    xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">12</span>, &amp;taskHandle_1);<br>    xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">2048</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">12</span>, &amp;taskHandle_2);<br><br>    <br>    <span class="hljs-comment">// 输出任务列表</span><br>    <span class="hljs-type">static</span> <span class="hljs-type">char</span> cBuffer[<span class="hljs-number">512</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br>    vTaskList(cBuffer);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;任务列表：\n%s&quot;</span>, cBuffer);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-type">int</span> istack = uxTaskGetStackHighWaterMark(taskHandle_1);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;Task_1 剩余栈空间：%d&quot;</span>, istack);<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/posts/58683/20250106233327.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-7-FreeRTOS-任务看门狗"><a href="#2-7-FreeRTOS-任务看门狗" class="headerlink" title="2.7 FreeRTOS 任务看门狗"></a>2.7 FreeRTOS 任务看门狗</h2><p>Task看门狗（Task Watchdog）是一种常用的任务监控机制，用于检测任务运行是否正常以及是否陷入死循环或长时间阻塞。<br>FreeRTOS 本身并不直接提供“看门狗”功能，需要我们使用软件自行实现， FreeRTOS 提供了 钩子函数，如 vApplicationIdleHook() 和 vApplicationTickHook()，可以在这些钩子函数中检查任务状态或者复位看门狗。</p>
<p>由于看门狗并不是FreeRTOS的原始功能，这里就不展开描述了，写这部分的目的是让大家知道这里应该有这个东西。</p>
<h1 id="三、FreeRTOS软件定时器"><a href="#三、FreeRTOS软件定时器" class="headerlink" title="三、FreeRTOS软件定时器"></a>三、FreeRTOS软件定时器</h1><p>FreeRTOS 软件定时器允许在任务上下文之外的时间间隔内执行函数，是一种高效的非阻塞操作方式。</p>
<p>FreeRTOS软件定时器主要有以下几个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xTimerCreate</td>
<td>创建定时器</td>
<td>创建一次性或周期性定时器</td>
</tr>
<tr>
<td>xTimerStart</td>
<td>启动定时器</td>
<td>定时器开始计时</td>
</tr>
<tr>
<td>xTimerStop</td>
<td>停止定时器</td>
<td>停止定时器计时</td>
</tr>
<tr>
<td>xTimerChangePeriod</td>
<td>修改定时器周期</td>
<td>可用于改变定时器运行间隔</td>
</tr>
<tr>
<td>xTimerDelete</td>
<td>删除定时器</td>
<td>释放定时器资源</td>
</tr>
<tr>
<td>xTimerReset</td>
<td>重置定时器</td>
<td></td>
</tr>
<tr>
<td>以下是主要 API 的详细说明：</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="3-1-API说明："><a href="#3-1-API说明：" class="headerlink" title="3.1 API说明："></a>3.1 API说明：</h2><h3 id="xTimerCreate"><a href="#xTimerCreate" class="headerlink" title="xTimerCreate"></a>xTimerCreate</h3><p><strong>功能：</strong> 创建一个软件定时器。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>TimerHandle_t <span class="hljs-title function_">xTimerCreate</span><span class="hljs-params">( </span><br><span class="hljs-params">    <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span> pcTimerName,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> TickType_t xTimerPeriodInTicks,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> UBaseType_t uxAutoReload,</span><br><span class="hljs-params">    <span class="hljs-type">void</span> * <span class="hljs-type">const</span> pvTimerID,</span><br><span class="hljs-params">    TimerCallbackFunction_t pxCallbackFunction </span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>pcTimerName</code>：定时器的名称，仅用于调试，可为 <code>NULL</code>。</li>
<li><code>xTimerPeriodInTicks</code>：定时器的时间周期（以系统 <code>tick</code> 为单位）。</li>
<li><code>uxAutoReload</code>：是否为自动重载模式，值为 <code>pdTRUE</code>（周期性定时器）或 <code>pdFALSE</code>（一次性定时器）。</li>
<li><code>pvTimerID</code>：用户定义的定时器标识，用于在回调函数中区分不同定时器。</li>
<li><code>pxCallbackFunction</code>：定时器触发时调用的回调函数。</li>
</ul>
<p><strong>返回值：</strong></p>
<p>成功返回 <code>TimerHandle_t</code>（定时器句柄），失败返回 <code>NULL</code>。- </p>
<h3 id="xTimerStart"><a href="#xTimerStart" class="headerlink" title="xTimerStart"></a>xTimerStart</h3><p><strong>功能：</strong>  启动一个软件定时器。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>BaseType_t <span class="hljs-title function_">xTimerStart</span><span class="hljs-params">( TimerHandle_t xTimer, TickType_t xTicksToWait )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>xTimer</code>：定时器句柄，由 <code>xTimerCreate</code> 返回。</li>
<li><code>xTicksToWait</code>：阻塞等待时间（以系统 tick 为单位）。通常为 0。<br><strong>返回值：</strong><br><code>pdPASS</code> 表示启动成功，<code>pdFAIL</code> 表示失败。</li>
</ul>
<h3 id="xTimerStop"><a href="#xTimerStop" class="headerlink" title="xTimerStop"></a>xTimerStop</h3><p><strong>功能：</strong> 停止一个正在运行的定时器。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>BaseType_t <span class="hljs-title function_">xTimerStop</span><span class="hljs-params">( TimerHandle_t xTimer, TickType_t xTicksToWait )</span>;<br></code></pre></td></tr></table></figure>
<p>参数说明：</p>
<p>xTimer：定时器句柄。<br>xTicksToWait：阻塞等待时间。<br>返回值：<br>pdPASS 表示停止成功，pdFAIL 表示失败。</p>
<h3 id="xTimerChangePeriod"><a href="#xTimerChangePeriod" class="headerlink" title="xTimerChangePeriod"></a>xTimerChangePeriod</h3><p><strong>功能：</strong> 改变定时器的触发周期。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTimerChangePeriod</span><span class="hljs-params">( TimerHandle_t xTimer, TickType_t xNewPeriod, TickType_t xTicksToWait )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>xTimer</code>：定时器句柄。</li>
<li><code>xNewPeriod</code>：新的触发周期（以系统 tick 为单位）。</li>
<li><code>xTicksToWait</code>：阻塞等待时间。</li>
</ul>
<p><strong>返回值：</strong>  <code>pdPASS</code> 表示成功，<code>pdFAIL</code> 表示失败。</p>
<h3 id="xTimerDelete"><a href="#xTimerDelete" class="headerlink" title="xTimerDelete"></a>xTimerDelete</h3><p>功能： 删除一个定时器并释放其资源。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTimerDelete</span><span class="hljs-params">( TimerHandle_t xTimer, TickType_t xTicksToWait )</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>xTimer</code>：定时器句柄。</li>
<li><code>xTicksToWait</code>：阻塞等待时间。<br>返回值： <code>pdPASS</code> 表示删除成功，<code>pdFAIL</code> 表示失败。</li>
</ul>
<h3 id="xTimerReset"><a href="#xTimerReset" class="headerlink" title="xTimerReset"></a>xTimerReset</h3><p><strong>功能：</strong> 重置定时器并重新开始计时。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTimerReset</span><span class="hljs-params">( TimerHandle_t xTimer, TickType_t xTicksToWait )</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>xTimer</code>：定时器句柄。</li>
<li><code>xTicksToWait</code>：阻塞等待时间。<br>返回值：<code>pdPASS</code> 表示成功，<code>pdFAIL</code> 表示失败。</li>
</ul>
<h2 id="3-2-示例代码："><a href="#3-2-示例代码：" class="headerlink" title="3.2 示例代码："></a>3.2 示例代码：</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/timers.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 定时器回调</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">TimerCallback_1</span><span class="hljs-params">(TimerHandle_t xTimer)</span><br>&#123;<br>    <span class="hljs-comment">// 取到定时器的名字</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *timerName = pcTimerGetName(xTimer);<br>    <span class="hljs-comment">// 取得定时器的ID</span><br>    <span class="hljs-type">void</span> *timerID = pvTimerGetTimerID(xTimer);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;定时器名称：%s,定时器id:%d,定时器回调函数执行&quot;</span>, timerName, (<span class="hljs-type">int</span>)timerID);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 创建定时器句柄</span><br>    TimerHandle_t xTimer_1;<br>    TimerHandle_t xTimer_2;<br>    xTimer_1 = xTimerCreate(<span class="hljs-string">&quot;timer1&quot;</span>, pdMS_TO_TICKS(<span class="hljs-number">1000</span>), pdTRUE, (<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>, TimerCallback_1);<br>    xTimer_2 = xTimerCreate(<span class="hljs-string">&quot;timer2&quot;</span>, pdMS_TO_TICKS(<span class="hljs-number">2000</span>), pdTRUE, (<span class="hljs-type">void</span> *)<span class="hljs-number">1</span>, TimerCallback_1);<br><br>    xTimerStart(xTimer_1, <span class="hljs-number">0</span>); <span class="hljs-comment">// 启动定时器</span><br>    xTimerStart(xTimer_2, <span class="hljs-number">0</span>); <span class="hljs-comment">// 启动定时器</span><br><br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>    <span class="hljs-comment">//停止定时器</span><br>    xTimerStop(xTimer_1, <span class="hljs-number">0</span>);<br>    xTimerStop(xTimer_2, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="四、FreeRTOS任务间通信"><a href="#四、FreeRTOS任务间通信" class="headerlink" title="四、FreeRTOS任务间通信"></a>四、FreeRTOS任务间通信</h1><h2 id="4-1-队列"><a href="#4-1-队列" class="headerlink" title="4.1 队列"></a>4.1 队列</h2><h3 id="4-1-1-队列创建与传参"><a href="#4-1-1-队列创建与传参" class="headerlink" title="4.1.1 队列创建与传参"></a>4.1.1 队列创建与传参</h3><p>队列是任务间通信的主要形式。它们可以用于在任务之间 以及中断和任务之间发送消息。在大多数情况下，队列用作线程安全的 FIFO（先进先出）缓冲区， 新数据被发送到队列的后面，但也可以发送到前面。</p>
<h4 id="4-1-1-1-API说明："><a href="#4-1-1-1-API说明：" class="headerlink" title="## 4.1.1.1  API说明："></a>## 4.1.1.1  API说明：</h4><p>队列操作主要涉及以下几个API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xQueueCreate</td>
<td>创建一个队列</td>
<td>创建指定长度和大小的队列</td>
</tr>
<tr>
<td>xQueueSend</td>
<td>向队列中发送数据</td>
<td>如果队列已满，任务可选择阻塞或立即返回</td>
</tr>
<tr>
<td>xQueueReceive</td>
<td>从队列中接收数据</td>
<td>如果队列为空，任务可选择阻塞或立即返回</td>
</tr>
<tr>
<td>xQueueSendToFront</td>
<td>将数据发送到队列的队头位置</td>
<td>与 xQueueSend 类似，但优先级更高</td>
</tr>
<tr>
<td>xQueueSendToBack</td>
<td>将数据发送到队列的队尾位置</td>
<td>默认行为，等效于 xQueueSend</td>
</tr>
<tr>
<td>uxQueueMessagesWaiting</td>
<td>查询队列中当前等待的消息数量</td>
<td>返回队列中尚未读取的消息数</td>
</tr>
</tbody></table>
<h5 id="xQueueCreate：创建队列"><a href="#xQueueCreate：创建队列" class="headerlink" title="xQueueCreate：创建队列"></a>xQueueCreate：创建队列</h5><p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">QueueHandle_t <span class="hljs-title function_">xQueueCreate</span><span class="hljs-params">(UBaseType_t uxQueueLength, UBaseType_t uxItemSize)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>uxQueueLength：队列的长度（可以容纳的元素数量）。</li>
<li>uxItemSize：队列中每个元素的大小（以字节为单位）。<br><strong>返回值：</strong> 成功时返回队列句柄；失败时返回 NULL。<br><strong>示例：</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">QueueHandle_t xQueue;<br>xQueue = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)); <span class="hljs-comment">// 创建一个可以存储 10 个整数的队列</span><br><span class="hljs-keyword">if</span> (xQueue == <span class="hljs-literal">NULL</span>) &#123;<br>    <span class="hljs-comment">// 队列创建失败，处理错误</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="xQueueSend：向队列发送数据"><a href="#xQueueSend：向队列发送数据" class="headerlink" title="xQueueSend：向队列发送数据"></a>xQueueSend：向队列发送数据</h5><p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xQueueSend</span><span class="hljs-params">(QueueHandle_t xQueue, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *pvItemToQueue, TickType_t xTicksToWait)</span>;<br><br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xQueue：队列的句柄。</li>
<li>pvItemToQueue：指向要发送到队列的数据的指针。</li>
<li>xTicksToWait：当队列已满时，任务等待的时间（以 tick 为单位）。设置为 0 表示不等待。</li>
</ul>
<p><strong>返回值：</strong></p>
<ul>
<li>pdPASS：数据成功发送到队列。</li>
<li>errQUEUE_FULL：队列已满，数据发送失败。<br>示例：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> data = <span class="hljs-number">42</span>;<br><span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;data, <span class="hljs-number">0</span>) != pdPASS) &#123;<br>    <span class="hljs-comment">// 数据发送失败，处理错误</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="xQueueReceive：从队列接收数据"><a href="#xQueueReceive：从队列接收数据" class="headerlink" title="xQueueReceive：从队列接收数据"></a>xQueueReceive：从队列接收数据</h5><p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xQueueReceive</span><span class="hljs-params">(QueueHandle_t xQueue, <span class="hljs-type">void</span> *pvBuffer, TickType_t xTicksToWait)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xQueue：队列的句柄。</li>
<li>pvBuffer：指向接收数据的缓冲区的指针。</li>
<li>xTicksToWait：当队列为空时，任务等待的时间（以 tick 为单位）。设置为 0 表示不等待。<br><strong>返回值：</strong></li>
<li>pdPASS：数据成功接收。</li>
<li>pdFALSE：队列为空，接收失败。<br><strong>示例：</strong><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> receivedData;<br><span class="hljs-keyword">if</span> (xQueueReceive(xQueue, &amp;receivedData, portMAX_DELAY) == pdPASS) &#123;<br>    <span class="hljs-comment">// 成功接收数据，进行处理</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-1-1-2-队列传参示例："><a href="#4-1-1-2-队列传参示例：" class="headerlink" title="4.1.1.2  队列传参示例："></a>4.1.1.2  队列传参示例：</h4><h5 id="1-队列传参-常量"><a href="#1-队列传参-常量" class="headerlink" title="1.队列传参-常量"></a>1.队列传参-常量</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/queue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;i, <span class="hljs-number">0</span>)!= pdPASS) &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据发送成功&quot;</span>);<br>            i++;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(i == <span class="hljs-number">10</span>)<br>        &#123;<br>            i = <span class="hljs-number">0</span>;<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-type">int</span> receivedData;<br>        <span class="hljs-keyword">if</span> (xQueueReceive(xQueue, &amp;receivedData, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据接收失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据接收成功，数据为：%d&quot;</span>, receivedData);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>        <br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    TaskHandle_t taskHandle_1 = <span class="hljs-literal">NULL</span>;<br>    TaskHandle_t taskHandle_2 = <span class="hljs-literal">NULL</span>;<br>    QueueHandle_t xQueue;<br><br>    <span class="hljs-comment">// 创建队列</span><br>    xQueue = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br><br>    <span class="hljs-keyword">if</span> (xQueue != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建成功&quot;</span>);<br>        <span class="hljs-comment">// 发送数据任务</span><br>        xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">12</span>, &amp;taskHandle_1);<br>        <span class="hljs-comment">// 接收数据任务</span><br>        xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">12</span>, &amp;taskHandle_2);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建失败&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="2-队列传参-结构体"><a href="#2-队列传参-结构体" class="headerlink" title="2.队列传参-结构体"></a>2.队列传参-结构体</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/queue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 定义结构体</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int</span> id;<br>    <span class="hljs-type">int</span> data[<span class="hljs-number">3</span>];<br>&#125; MyStruct;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    MyStruct shendData = &#123;<span class="hljs-number">1</span>, &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;&#125;;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;shendData, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据发送成功&quot;</span>);<br>            shendData.id++;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (shendData.id == <span class="hljs-number">10</span>)<br>        &#123;<br>            shendData.id = <span class="hljs-number">0</span>;<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        MyStruct receivedData;<br>        <span class="hljs-keyword">if</span> (xQueueReceive(xQueue, &amp;receivedData, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据接收失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据接收成功，数据为：%d-[%d,%d,%d]&quot;</span>, receivedData.id, receivedData.data[<span class="hljs-number">0</span>], receivedData.data[<span class="hljs-number">1</span>], receivedData.data[<span class="hljs-number">2</span>]);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>        <br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    TaskHandle_t taskHandle_1 = <span class="hljs-literal">NULL</span>;<br>    TaskHandle_t taskHandle_2 = <span class="hljs-literal">NULL</span>;<br>    QueueHandle_t xQueue;<br><br>    <span class="hljs-comment">// 创建队列</span><br>    xQueue = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(MyStruct));<br><br>    <span class="hljs-keyword">if</span> (xQueue != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建成功&quot;</span>);<br>        <span class="hljs-comment">// 发送数据任务</span><br>        xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">12</span>, &amp;taskHandle_1);<br>        <span class="hljs-comment">// 接收数据任务</span><br>        xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">12</span>, &amp;taskHandle_2);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建失败&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h5 id="3-队列传参-指针"><a href="#3-队列传参-指针" class="headerlink" title="3.队列传参-指针"></a>3.队列传参-指针</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 队列传参_指针: 一般用于传递占用内存较大的数据. 传递指针, 可以避免拷贝数据, 提高效率.</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/queue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-type">char</span> *pCharSend = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">50</span>); <span class="hljs-comment">// 申请内存</span><br>        <span class="hljs-built_in">snprintf</span>(pCharSend, <span class="hljs-number">50</span>, <span class="hljs-string">&quot;Hello World! - %d&quot;</span>, i);<br>        i++;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;pCharSend, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据发送成功&quot;</span>);<br>            <br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">10</span>)<br>        &#123;<br>            i = <span class="hljs-number">0</span>;<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br><br>    <span class="hljs-type">char</span> *pCharReceived = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 接收数据</span><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (xQueueReceive(xQueue, &amp;pCharReceived, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据接收失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;数据接收成功，数据为：%s&quot;</span>, pCharReceived);<br>            <span class="hljs-built_in">free</span>(pCharReceived); <span class="hljs-comment">// 释放内存</span><br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>        <br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    TaskHandle_t taskHandle_1 = <span class="hljs-literal">NULL</span>;<br>    TaskHandle_t taskHandle_2 = <span class="hljs-literal">NULL</span>;<br>    QueueHandle_t xQueue;<br><br>    <span class="hljs-comment">// 创建队列</span><br>    xQueue = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span> *));<br><br>    <span class="hljs-keyword">if</span> (xQueue != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建成功&quot;</span>);<br>        <span class="hljs-comment">// 发送数据任务</span><br>        xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">12</span>, &amp;taskHandle_1);<br>        <span class="hljs-comment">// 接收数据任务</span><br>        xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">12</span>, &amp;taskHandle_2);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建失败&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="4-1-2-队列多进单出模型"><a href="#4-1-2-队列多进单出模型" class="headerlink" title="4.1.2 队列多进单出模型"></a>4.1.2 队列多进单出模型</h3><p><img src="/posts/58683/20250110165359.png" srcset="/img/loading.gif" lazyload></p>
<p>示例代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 队列多进单出: 任务1和任务2发送数据到队列，任务3接收数据  任务3的优先级高于任务1和任务2,已达到数据监听的目的</span><br><span class="hljs-comment">// 参考:https://www.bilibili.com/video/BV1R44y177VS/?spm_id_from=333.788.top_right_bar_window_history.content.click&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/queue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">111</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;i, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1数据发送成功&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">222</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;i, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务2数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务2数据发送成功&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-type">int</span> receivedData;<br>        <span class="hljs-comment">// 使用portMAX_DELAY阻塞等待数据</span><br>        <span class="hljs-keyword">if</span> (xQueueReceive(xQueue, &amp;receivedData, portMAX_DELAY) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务3数据接收失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务3数据接收成功，数据为：%d&quot;</span>, receivedData);<br>        &#125;<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><br>    QueueHandle_t xQueue;<br><br>    <span class="hljs-comment">// 创建队列</span><br>    xQueue = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br><br>    <span class="hljs-keyword">if</span> (xQueue != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建成功&quot;</span>);<br>        <span class="hljs-comment">// 发送数据任务</span><br>        xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        <span class="hljs-comment">// 接收数据任务</span><br>        xTaskCreate(Task_3, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue, <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建失败&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>


<h3 id="4-1-3-队列集合"><a href="#4-1-3-队列集合" class="headerlink" title="4.1.3 队列集合"></a>4.1.3 队列集合</h3><p>FreeRTOS 队列集合（Queue Sets）是一种机制，用于同时监听多个队列和信号量，以实现任务间的高效通信。</p>
<h4 id="4-1-3-1-API说明："><a href="#4-1-3-1-API说明：" class="headerlink" title="4.1.3.1 API说明："></a>4.1.3.1 API说明：</h4><table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xQueueCreateSet</td>
<td>创建一个队列集合</td>
<td>队列集合必须与队列或信号量配合使用</td>
</tr>
<tr>
<td>xQueueAddToSet</td>
<td>将队列或信号量添加到队列集合</td>
<td>被添加的队列或信号量必须为空</td>
</tr>
<tr>
<td>xQueueRemoveFromSet</td>
<td>从队列集合中移除队列或信号量</td>
<td></td>
</tr>
<tr>
<td>xQueueSelectFromSet</td>
<td>从队列集合中选择一个有数据可用的队列或信号量</td>
<td>返回非空的队列或信号量</td>
</tr>
</tbody></table>
<h4 id="4-1-3-2-示例代码："><a href="#4-1-3-2-示例代码：" class="headerlink" title="4.1.3.2 示例代码："></a>4.1.3.2 示例代码：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 队列集合:</span><br><span class="hljs-comment">// https : // www.bilibili.com/video/BV1zq4y1m7UK?spm_id_from=333.788.videopod.sections&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/queue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">111</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;i, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1数据发送成功&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t xQueue = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">222</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueSend(xQueue, &amp;i, <span class="hljs-number">0</span>) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务2数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务2数据发送成功&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列集合句柄</span><br>    QueueSetHandle_t xQueueSet = (QueueSetHandle_t)pvParameters;<br>    <span class="hljs-comment">// 取得有数据队列句柄</span><br>    QueueSetMemberHandle_t QueueData;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        QueueData = xQueueSelectFromSet(xQueueSet, portMAX_DELAY);<br>        <span class="hljs-keyword">if</span> (QueueData != <span class="hljs-literal">NULL</span>)<br>        &#123;<br>            <span class="hljs-type">int</span> i;<br>            <span class="hljs-keyword">if</span> (xQueueReceive(QueueData, &amp;i, portMAX_DELAY) != pdPASS)<br>            &#123;<br>                ESP_LOGI(TAG, <span class="hljs-string">&quot;任务3数据接收失败&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                ESP_LOGI(TAG, <span class="hljs-string">&quot;任务3数据接收成功，数据为：%d&quot;</span>, i);<br>            &#125;<br>        &#125;<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    QueueHandle_t xQueue_1;<br>    QueueHandle_t xQueue_2;<br>    <span class="hljs-comment">// 创建队列</span><br>    xQueue_1 = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br>    xQueue_2 = xQueueCreate(<span class="hljs-number">10</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br><br>    <span class="hljs-comment">// 创建队列集合</span><br>    QueueSetHandle_t xQueueSet;<br>    xQueueSet = xQueueCreateSet(<span class="hljs-number">20</span>);<br><br>    <span class="hljs-comment">// 将队列添加到队列集合</span><br>    xQueueAddToSet(xQueue_1, xQueueSet);<br>    xQueueAddToSet(xQueue_2, xQueueSet);<br><br>    <span class="hljs-keyword">if</span> ((xQueue_1 != <span class="hljs-literal">NULL</span> )&amp;&amp; (xQueue_2 != <span class="hljs-literal">NULL</span>) &amp;&amp; (xQueueSet != <span class="hljs-literal">NULL</span>))<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建成功&quot;</span>);<br>        <span class="hljs-comment">// 发送数据任务</span><br>        xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue_1, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueue_2, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        <span class="hljs-comment">// 接收数据任务</span><br>        xTaskCreate(Task_3, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)xQueueSet, <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建失败&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-1-4-队列邮箱"><a href="#4-1-4-队列邮箱" class="headerlink" title="4.1.4 队列邮箱"></a>4.1.4 队列邮箱</h3><p>FreeRTOS的邮箱概念跟别的RTOS不一样,它是一个队列，队列长度只有1.写邮箱：新数据覆盖旧数据,读邮箱：读数据时，数据不会被移除；这意味着，第一次调用时会因为无数据而阻塞，一旦曾经写入数据，以后读邮箱时总能成功。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 队列邮箱: FreeRTOS的邮箱概念跟别的RTOS不一样,它是一个队列，队列长度只有1.</span><br><span class="hljs-comment">// 写邮箱：新数据覆盖旧数据,读邮箱：读数据时，数据不会被移除；</span><br><span class="hljs-comment">// 这意味着，第一次调用时会因为无数据而阻塞，一旦曾经写入数据，以后读邮箱时总能成功。</span><br><span class="hljs-comment">// https : // www.bilibili.com/video/BV1zq4y1m7UK?spm_id_from=333.788.videopod.sections&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/queue.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 写数据队列</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t Mailbox = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 发送数据到队列</span><br>        <span class="hljs-keyword">if</span> (xQueueOverwrite(Mailbox, &amp;i) != pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1数据发送失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务1数据发送成功&quot;</span>);<br>        &#125;<br>        i++;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><br><span class="hljs-comment">// 读数据队列</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t Mailbox = (QueueHandle_t)pvParameters;<br><br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 读取数据</span><br>        <span class="hljs-keyword">if</span> (xQueuePeek(Mailbox, &amp;i, portMAX_DELAY) == pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务2数据读取成功，数据为：%d&quot;</span>, i);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务2数据读取失败&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t Mailbox = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 读取数据</span><br>        <span class="hljs-keyword">if</span> (xQueuePeek(Mailbox, &amp;i, portMAX_DELAY) == pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务3数据读取成功，数据为：%d&quot;</span>, i);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务3数据读取失败&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Task_4</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 取得队列句柄</span><br>    QueueHandle_t Mailbox = (QueueHandle_t)pvParameters;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 读取数据</span><br>        <span class="hljs-keyword">if</span> (xQueuePeek(Mailbox, &amp;i, portMAX_DELAY) == pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务4数据读取成功，数据为：%d&quot;</span>, i);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;任务4数据读取失败&quot;</span>);<br>        &#125;<br>        vTaskDelay(<span class="hljs-number">1000</span> / portTICK_PERIOD_MS);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    QueueHandle_t Mailbox; <span class="hljs-comment">// 创建邮箱</span><br><br>    <span class="hljs-comment">// 创建队列(注意：队列长度只有1)</span><br>    Mailbox = xQueueCreate(<span class="hljs-number">1</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br><br>    <span class="hljs-keyword">if</span> ((Mailbox != <span class="hljs-literal">NULL</span>) )<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建成功&quot;</span>);<br>        <span class="hljs-comment">// 写数据任务</span><br>        xTaskCreate(Task_1, <span class="hljs-string">&quot;Task_1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)Mailbox, <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(Task_2, <span class="hljs-string">&quot;Task_2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)Mailbox, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(Task_3, <span class="hljs-string">&quot;Task_3&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)Mailbox, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(Task_4, <span class="hljs-string">&quot;Task_4&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, (<span class="hljs-type">void</span> *)Mailbox, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;队列创建失败&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="4-2-信号量、互斥锁"><a href="#4-2-信号量、互斥锁" class="headerlink" title="4.2 信号量、互斥锁"></a>4.2 信号量、互斥锁</h2><p>FreeRTOS 提供了信号量和互斥锁，用于任务间的同步和资源共享管理。信号量更偏向于任务同步，而互斥锁用于保护共享资源。</p>
<h3 id="4-2-1-二进制信号量"><a href="#4-2-1-二进制信号量" class="headerlink" title="4.2.1 二进制信号量"></a>4.2.1 二进制信号量</h3><p>二进制信号量是最基本的信号量，仅有两个状态：可用和不可用（或 1 和 0）。<br>通常用于任务之间或中断与任务之间的同步，当一个事件发生时，由中断或任务释放信号量，等待信号量的任务就会被唤醒。<br>二进制信号量适用于简单的事件通知场景，比如通知某个任务处理外部输入或完成某项任务。</p>
<h4 id="4-2-1-1-API说明："><a href="#4-2-1-1-API说明：" class="headerlink" title="4.2.1.1 API说明："></a>4.2.1.1 API说明：</h4><h4 id="4-2-1-2-示例代码："><a href="#4-2-1-2-示例代码：" class="headerlink" title="4.2.1.2 示例代码："></a>4.2.1.2 示例代码：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 二进制信号量</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/semphr.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 二进制信号量</span><br>SemaphoreHandle_t semaphoreHandle;<br><br><span class="hljs-comment">// 公共变量</span><br><span class="hljs-type">int</span> shareVariable = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 获取信号量,信号量变为0</span><br>        xSemaphoreTake(semaphoreHandle, portMAX_DELAY);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>        &#123;<br>            shareVariable++;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1 shareVariable:%d&quot;</span>, shareVariable);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>        <span class="hljs-comment">// 释放信号量,信号量变为1</span><br>        xSemaphoreGive(semaphoreHandle);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 获取信号量</span><br>        xSemaphoreTake(semaphoreHandle, portMAX_DELAY);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>        &#123;<br>            shareVariable++;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task2 shareVariable:%d&quot;</span>, shareVariable);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>        <span class="hljs-comment">// 释放信号量,信号量变为1</span><br>        xSemaphoreGive(semaphoreHandle);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    semaphoreHandle = xSemaphoreCreateBinary();<br>    xSemaphoreGive(semaphoreHandle);<br><br>    <span class="hljs-comment">// 创建任务</span><br>    xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>, <span class="hljs-literal">NULL</span>);<br>    xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-2-计数信号量"><a href="#4-2-2-计数信号量" class="headerlink" title="4.2.2 计数信号量"></a>4.2.2 计数信号量</h3><h4 id="4-2-2-2-示例代码："><a href="#4-2-2-2-示例代码：" class="headerlink" title="4.2.2.2 示例代码："></a>4.2.2.2 示例代码：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 计数型信号量(占座)</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/semphr.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-comment">// 信号量</span><br>SemaphoreHandle_t semaphoreHandle;<br><br><br><span class="hljs-comment">// 占座任务</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-comment">// 定义空位</span><br>    <span class="hljs-type">int</span> seat = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        <span class="hljs-comment">// 获取信号量</span><br>        seat = uxSemaphoreGetCount(semaphoreHandle);<br>        <span class="hljs-comment">// 输出空位</span><br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;当前空位:%d&quot;</span>, seat);<br><br>        <span class="hljs-comment">// 获取信号量(占座)</span><br>        <span class="hljs-keyword">if</span> (xSemaphoreTake(semaphoreHandle, portMAX_DELAY) == pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;占座成功&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;占座失败&quot;</span>);<br>        &#125;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 离开座位任务</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (;;)<br>    &#123;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">6000</span>));<br>        <span class="hljs-comment">// 释放信号量</span><br>        xSemaphoreGive(semaphoreHandle);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;释放座位&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    semaphoreHandle = xSemaphoreCreateCounting(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>);<br><br>    <span class="hljs-comment">// 创建占座任务</span><br>    xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-comment">// 创建离开座位任务</span><br>    xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="4-2-3-互斥量"><a href="#4-2-3-互斥量" class="headerlink" title="4.2.3 互斥量"></a>4.2.3 互斥量</h3><p>互斥量(互斥锁Mutex):互斥锁和二进制信号量极为相似，但 有一些细微差异：互斥锁具有优先级继承机制， 但二进制信号量没有。</p>
<h4 id="4-2-3-2-示例代码："><a href="#4-2-3-2-示例代码：" class="headerlink" title="4.2.3.2 示例代码："></a>4.2.3.2 示例代码：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/semphr.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br>SemaphoreHandle_t mutexHandle;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (xSemaphoreTake(mutexHandle, portMAX_DELAY) == pdTRUE)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1获取到互斥量!&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>            &#123;<br>                ESP_LOGI(TAG, <span class="hljs-string">&quot;task1执行中...%d&quot;</span>, i);<br>                vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>            &#125;<br>            xSemaphoreGive(mutexHandle);<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1释放互斥量!&quot;</span>);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1获取互斥量失败!&quot;</span>);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task3启动!&quot;</span>);<br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (xSemaphoreTake(mutexHandle, <span class="hljs-number">1000</span>) == pdPASS)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task3获取到互斥量!&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>            &#123;<br>                ESP_LOGI(TAG, <span class="hljs-string">&quot;task3执行中...%d&quot;</span>,i);<br>                vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>            &#125;<br><br>            xSemaphoreGive(mutexHandle);<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task3释放互斥量!&quot;</span>);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task3未获取到互斥量!&quot;</span>);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mutexHandle = xSemaphoreCreateMutex();<br>    <span class="hljs-comment">// mutexHandle = xSemaphoreCreateBinary();</span><br>    xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>);<br>    xTaskCreate(task3, <span class="hljs-string">&quot;task3&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="4-2-4-递归互斥量"><a href="#4-2-4-递归互斥量" class="headerlink" title="4.2.4 递归互斥量"></a>4.2.4 递归互斥量</h3><p>非递归互斥锁只能被一个任务 获取一次，如果同一个任务想再次获取则会失败， 因为当任务第一次释放互斥锁时，互斥锁就一直处于释放状态。与非递归互斥锁相反，递归互斥锁可以被同一个任务获取很多次， 获取多少次就需要释放多少次， 此时才会返回递归互斥锁。</p>
<h4 id="4-2-4-2-示例代码："><a href="#4-2-4-2-示例代码：" class="headerlink" title="4.2.4.2 示例代码："></a>4.2.4.2 示例代码：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/semphr.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br>SemaphoreHandle_t mutexHandle;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        xSemaphoreTakeRecursive(mutexHandle, portMAX_DELAY);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1获取到互斥量-使用资源A&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1执行中...%d -使用资源A&quot;</span>, i);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br><br>        xSemaphoreTakeRecursive(mutexHandle, portMAX_DELAY);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1获取到互斥量-使用资源B&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1执行中...%d -使用资源B&quot;</span>, i);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br><br>        xSemaphoreGiveRecursive(mutexHandle);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1释放互斥量-使用资源B&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>        xSemaphoreGiveRecursive(mutexHandle);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1释放互斥量-使用资源A&quot;</span>);<br>    &#125;<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">// 获取递归互斥锁</span><br>        <span class="hljs-keyword">if</span> (xSemaphoreTakeRecursive(mutexHandle, portMAX_DELAY) == pdTRUE)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task2获取到互斥量&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>            &#123;<br>                ESP_LOGI(TAG, <span class="hljs-string">&quot;task2执行中...%d&quot;</span>, i);<br>                vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>            &#125;<br>            xSemaphoreGiveRecursive(mutexHandle);<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task2释放互斥量&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task2获取互斥量失败&quot;</span>);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 创建递归互斥量</span><br>    mutexHandle = xSemaphoreCreateRecursiveMutex();<br><br>    xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="4-3-事件组"><a href="#4-3-事件组" class="headerlink" title="4.3 事件组"></a>4.3 事件组</h2><p>事件组是一种实现任务间通信和同步的机制，主要用于协调多个任务或中断之间的执行。</p>
<p><strong>事件位（事件标志）</strong>：<br>事件位用于指示事件 是否发生。事件位通常称为事件标志。例如， 应用程序可以：<br>定义一个位（或标志）， 设置为 1 时表示“已收到消息并准备好处理”， 设置为 0 时表示“没有消息等待处理”。<br>定义一个位（或标志）， 设置为 1 时表示“应用程序已将准备发送到网络的消息排队”， 设置为 0 时表示 “没有消息需要排队准备发送到网络”。<br>定义一个位（或标志）， 设置为 1 时表示“需要向网络发送心跳消息”， 设置为 0 时表示“不需要向网络发送心跳消息”。</p>
<p><strong>事件组</strong>：<br>事件组就是一组事件位。事件组中的事件位 通过位编号来引用。同样，以上面列出的三个例子为例：<br>事件标志组位编号 为 0 表示“已收到消息并准备好处理”。<br>事件标志组位编号 为 1 表示“应用程序已将准备发送到网络的消息排队”。<br>事件标志组位编号 为 2 表示“需要向网络发送心跳消息”。</p>
<p><strong>事件组和事件位数据类型</strong>：</p>
<p>事件组由 EventGroupHandle_t 类型的变量引用。</p>
<p>如果 configUSE_16_BIT_TICKS 设为 1，则事件组中存储的位（或标志）数为 8； 如果 configUSE_16_BIT_TICKS 设为 0，则为 24。 configUSE_16_BIT_TICKS 的值取决于 任务内部实现中用于线程本地存储的数据类型。</p>
<blockquote>
<p>(ESP-IDF中默认为24位)</p>
</blockquote>
<p>事件组中的所有事件位都 存储在 EventBits_t 类型的单个无符号整数变量中。事件位 0 存储在位 0 中， 事件位 1 存储在位1 中，依此类推。</p>
<p>下图表示一个 24 位事件组， 使用 3 个位来保存前面描述的 3 个示例事件。在图片中，仅设置了 事件位 2。（包含 24 个事件位的事件组，其中只有三个在使用中）</p>
<p><img src="/posts/58683/20250111145800.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>事件组 RTOS API 函数</strong></p>
<p>提供的事件组 API 函数 允许任务在事件组中设置一个或多个事件位， 清除事件组中的一个或多个事件位， 并挂起（进入阻塞状态， 因此任务不会消耗任何处理时间）以等待 事件组中一个或多个事件位固定下来。</p>
<p>事件组也可用于同步任务， 创建通常称为“集合”的任务。任务同步点是 应用程序代码中的一个位置，在该位置任务将在 阻塞状态（不消耗任何 CPU 时间）下等待，直到参与同步的所有其他任务 也到达其同步点。</p>
<h4 id="4-3-1-API说明："><a href="#4-3-1-API说明：" class="headerlink" title="4.3.1 API说明："></a>4.3.1 API说明：</h4><p>事件组操作主要涉及以下几个 API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xEventGroupCreate</td>
<td>创建一个事件组</td>
<td>返回一个事件组句柄，供后续操作使用</td>
</tr>
<tr>
<td>xEventGroupSetBits</td>
<td>设置一个或多个事件标志</td>
<td>用于通知其他任务某些事件已发生</td>
</tr>
<tr>
<td>xEventGroupClearBits</td>
<td>清除一个或多个事件标志</td>
<td>用于复位事件标志，防止重复触发</td>
</tr>
<tr>
<td>xEventGroupWaitBits</td>
<td>等待一个或多个事件标志的设置状态</td>
<td>任务可以选择阻塞，直到指定事件发生</td>
</tr>
<tr>
<td>xEventGroupGetBits</td>
<td>查询当前事件组的状态</td>
<td>返回事件组中所有事件标志的当前状态</td>
</tr>
<tr>
<td>xEventGroupSync</td>
<td>同步多个任务</td>
<td>用于实现多个任务在同一时刻达到某一同步点后继续执行</td>
</tr>
</tbody></table>
<h5 id="xEventGroupCreate：创建事件组"><a href="#xEventGroupCreate：创建事件组" class="headerlink" title="xEventGroupCreate：创建事件组"></a>xEventGroupCreate：创建事件组</h5><p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">EventGroupHandle_t <span class="hljs-title function_">xEventGroupCreate</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>返回值</strong>：成功时返回事件组句柄；失败时返回 NULL。</p>
<p><strong>示例：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">EventGroupHandle_t xEventGroup;<br>xEventGroup = xEventGroupCreate();<br><span class="hljs-keyword">if</span> (xEventGroup == <span class="hljs-literal">NULL</span>) &#123;<br>    <span class="hljs-comment">// 创建事件组失败，处理错误</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="xEventGroupSetBits：设置事件标志"><a href="#xEventGroupSetBits：设置事件标志" class="headerlink" title="xEventGroupSetBits：设置事件标志"></a>xEventGroupSetBits：设置事件标志</h5><p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">EventBits_t <span class="hljs-title function_">xEventGroupSetBits</span><span class="hljs-params">(EventGroupHandle_t xEventGroup, <span class="hljs-type">const</span> EventBits_t uxBitsToSet)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li>xEventGroup：事件组句柄。</li>
<li>uxBitsToSet：需要设置的事件标志位（按位表示，例如 0x01 设置第 0 位）。<br><strong>返回值</strong>：返回事件组在调用前的状态。</li>
</ul>
<h5 id="xEventGroupWaitBits：等待事件标志"><a href="#xEventGroupWaitBits：等待事件标志" class="headerlink" title="xEventGroupWaitBits：等待事件标志"></a>xEventGroupWaitBits：等待事件标志</h5><p>读取 RTOS 事件组中的位，选择性地进入“阻塞”状态（已设置 超时值）以等待设置单个位或一组位。无法从中断调用此函数。</p>
<p><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">EventBits_t <span class="hljs-title function_">xEventGroupWaitBits</span><span class="hljs-params">(</span><br><span class="hljs-params">    EventGroupHandle_t xEventGroup,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> EventBits_t uxBitsToWaitFor,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> BaseType_t xClearOnExit,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> BaseType_t xWaitForAllBits,</span><br><span class="hljs-params">    TickType_t xTicksToWait</span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li>xEventGroup：事件组句柄。</li>
<li>uxBitsToWaitFor：需要等待的事件标志位（按位表示）。</li>
<li>xClearOnExit：是否在退出等待时清除指定的事件标志。</li>
<li>xWaitForAllBits：是否等待所有指定事件标志都被设置，还是任意一个即可。</li>
<li>xTicksToWait：等待的最大时间（以 Tick 为单位，portMAX_DELAY 表示无限等待）。</li>
</ul>
<p><strong>返回值</strong>：返回当前满足条件的事件标志状态。</p>
<p><strong>示例</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">EventBits_t uxBits;<br>uxBits = xEventGroupWaitBits(<br>    xEventGroup,      <span class="hljs-comment">// 事件组句柄</span><br>    <span class="hljs-number">0x03</span>,             <span class="hljs-comment">// 等待第 0 位和第 1 位</span><br>    pdTRUE,           <span class="hljs-comment">// 退出等待时清除事件标志</span><br>    pdFALSE,          <span class="hljs-comment">// 等待任意一个事件</span><br>    portMAX_DELAY     <span class="hljs-comment">// 无限等待</span><br>);<br><br><span class="hljs-keyword">if</span> (uxBits &amp; <span class="hljs-number">0x01</span>) &#123;<br>    <span class="hljs-comment">// 第 0 位事件发生</span><br>&#125;<br><br><span class="hljs-keyword">if</span> (uxBits &amp; <span class="hljs-number">0x02</span>) &#123;<br>    <span class="hljs-comment">// 第 1 位事件发生</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="xEventGroupSync：同步任务"><a href="#xEventGroupSync：同步任务" class="headerlink" title="xEventGroupSync：同步任务"></a>xEventGroupSync：同步任务</h5><p>以原子方式设置 RTOS 事件组中的位（标志），然后等待在同一事件组中设置位的组合。此功能通常用于同步多个任务（通常称为任务集合），其中每个任务必须等待其他任务到达同步点后才能继续。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">EventBits_t <span class="hljs-title function_">xEventGroupSync</span><span class="hljs-params">(</span><br><span class="hljs-params">    EventGroupHandle_t xEventGroup,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> EventBits_t uxBitsToSet,</span><br><span class="hljs-params">    <span class="hljs-type">const</span> EventBits_t uxBitsToWaitFor,</span><br><span class="hljs-params">    TickType_t xTicksToWait</span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数说明</strong>：</p>
<ul>
<li>xEventGroup：事件组句柄。</li>
<li>uxBitsToSet：当前任务设置的事件标志位。</li>
<li>uxBitsToWaitFor：需要等待的其他任务设置的事件标志位。</li>
<li>xTicksToWait：最大等待时间。<br><strong>返回值</strong>：<br>返回事件组的当前状态。</li>
</ul>
<p><strong>示例</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">xEventGroupSync(<br>    xEventGroup,  <span class="hljs-comment">// 事件组句柄</span><br>    <span class="hljs-number">0x01</span>,         <span class="hljs-comment">// 当前任务设置第 0 位</span><br>    <span class="hljs-number">0x03</span>,         <span class="hljs-comment">// 等待第 0 位和第 1 位都被设置</span><br>    portMAX_DELAY <span class="hljs-comment">// 无限等待</span><br>);<br></code></pre></td></tr></table></figure>

<h4 id="4-3-2-示例程序："><a href="#4-3-2-示例程序：" class="headerlink" title="4.3.2 示例程序："></a>4.3.2 示例程序：</h4><h6 id="1-事件组等待"><a href="#1-事件组等待" class="headerlink" title="1. 事件组等待"></a>1. 事件组等待</h6><p>task1等待task2设置事件位，然后执行程序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 事件组</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/event_groups.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br>EventGroupHandle_t xCreatedEventGroup;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BIT_0 (1 &lt;&lt; 0)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BIT_4 (1 &lt;&lt; 4)</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        EventBits_t uxBits;<br>        uxBits = xEventGroupWaitBits(<br>            xCreatedEventGroup, <span class="hljs-comment">/* The event group being tested. */</span><br>            BIT_0 | BIT_4,      <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            pdTRUE,             <span class="hljs-comment">/* BIT_0 &amp; BIT_4 should be cleared before returning. */</span><br>            pdFALSE,            <span class="hljs-comment">/* Don&#x27;t wait for both bits, either bit will do. */</span><br>            portMAX_DELAY);     <span class="hljs-comment">/* Wait a maximum of 100ms for either bit to be set. */</span><br><br>        <span class="hljs-keyword">if</span> ((uxBits &amp; (BIT_0 | BIT_4)) == (BIT_0 | BIT_4))<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;BIT_0 和 BIT_4 都被设置了&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;BIT_0 和 BIT_4 有一个被设置了&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        xEventGroupSetBits(xCreatedEventGroup, BIT_0);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;BIT_0 被设置&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>        xEventGroupSetBits(xCreatedEventGroup, BIT_4);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;BIT_4 被设置&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><br>    <span class="hljs-comment">// 创建事件组</span><br>    xCreatedEventGroup = xEventGroupCreate();<br><br>    <span class="hljs-keyword">if</span> (xCreatedEventGroup == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGE(TAG, <span class="hljs-string">&quot;创建事件组失败&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h6 id="2-事件组同步"><a href="#2-事件组同步" class="headerlink" title="2. 事件组同步"></a>2. 事件组同步</h6><p>每个任务在启动后，等待一段时间，然后调用xEventGroupSync函数进行事件同步，等待所有任务的事件位都被设置。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 事件组</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/event_groups.h&quot;</span></span><br><br><span class="hljs-comment">/* Bits used by the three tasks. */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_0_BIT (1 &lt;&lt; 0)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_1_BIT (1 &lt;&lt; 1)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_2_BIT (1 &lt;&lt; 2)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ALL_SYNC_BITS (TASK_0_BIT | TASK_1_BIT | TASK_2_BIT)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br>EventGroupHandle_t xEventBits;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task0</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task0启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task0: 任务同步开始&quot;</span>);<br>        <span class="hljs-comment">// 事件同步</span><br>        xEventGroupSync(<br>            xEventBits,     <span class="hljs-comment">/* The event group being tested. */</span><br>            TASK_0_BIT,     <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            ALL_SYNC_BITS,  <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            portMAX_DELAY); <span class="hljs-comment">/* Wait a maximum of 100ms for either bit to be set. */</span><br><br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task0: 任务同步完成&quot;</span>);<br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    &#125;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">4000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 任务同步开始&quot;</span>);<br><br>        <span class="hljs-comment">// 事件同步</span><br>        xEventGroupSync(<br>            xEventBits,     <span class="hljs-comment">/* The event group being tested. */</span><br>            TASK_1_BIT,     <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            ALL_SYNC_BITS,  <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            portMAX_DELAY); <span class="hljs-comment">/* Wait a maximum of 100ms for either bit to be set. */</span><br><br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 任务同步完成&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task2: 任务同步开始&quot;</span>);<br>        <span class="hljs-comment">// 事件同步</span><br>        xEventGroupSync(<br>            xEventBits,     <span class="hljs-comment">/* The event group being tested. */</span><br>            TASK_2_BIT,     <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            ALL_SYNC_BITS,  <span class="hljs-comment">/* The bits within the event group to wait for. */</span><br>            portMAX_DELAY); <span class="hljs-comment">/* Wait a maximum of 100ms for either bit to be set. */</span><br><br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task2: 任务同步完成&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 创建事件组</span><br>    xEventBits = xEventGroupCreate();<br><br>    <span class="hljs-keyword">if</span> (xEventBits == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGE(TAG, <span class="hljs-string">&quot;创建事件组失败&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        xTaskCreate(task0, <span class="hljs-string">&quot;task0&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h2 id="4-4-任务通知"><a href="#4-4-任务通知" class="headerlink" title="4.4 任务通知"></a>4.4 任务通知</h2><p>任务通知（Task Notifications）是一种轻量级的任务间通信和同步机制，它比队列或事件组更加高效，因为它不需要动态分配内存。每个任务都内置了一个任务通知值，其他任务或中断服务例程（ISR）可以用它来通知该任务事件的发生。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>每个任务都有一个任务通知值（32 位整数），可以用于存储信息。</li>
<li>任务通知值默认初始化为 0。</li>
<li>一个任务可以通过 通知函数 来操作另一个任务的通知值。</li>
<li>可以将任务通知值用作二值信号量、计数信号量或简单的 32 位变量。</li>
<li>当一个任务收到通知时，它可以选择阻塞（等待通知）或处理该通知。</li>
</ul>
<h3 id="4-4-1-API说明："><a href="#4-4-1-API说明：" class="headerlink" title="4.4.1 API说明："></a>4.4.1 API说明：</h3><p>任务通知主要涉及以下几个 API：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>xTaskNotify</td>
<td>向指定任务发送通知，通知值可以被覆盖</td>
</tr>
<tr>
<td>xTaskNotifyGive</td>
<td>简化版通知函数，用于发送信号量通知</td>
</tr>
<tr>
<td>xTaskNotifyWait</td>
<td>等待通知值更新，并选择是否清除通知值</td>
</tr>
<tr>
<td>ulTaskNotifyTake</td>
<td>等待任务通知并自动减少通知值（通常用于计数信号量）</td>
</tr>
<tr>
<td>xTaskNotifyStateClear</td>
<td>清除任务的通知状态</td>
</tr>
</tbody></table>
<h4 id="xTaskNotify"><a href="#xTaskNotify" class="headerlink" title="xTaskNotify"></a>xTaskNotify</h4><p><strong>功能</strong>： 向指定任务发送通知，并修改该任务的通知值。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTaskNotify</span><span class="hljs-params">(</span><br><span class="hljs-params">    TaskHandle_t xTaskToNotify,</span><br><span class="hljs-params">    <span class="hljs-type">uint32_t</span> ulValue,</span><br><span class="hljs-params">    eNotifyAction eAction</span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>xTaskToNotify：接收通知的任务句柄。</li>
<li>ulValue：要发送的通知值。</li>
<li>eAction：通知值的操作类型，可以是以下值：</li>
<li>eSetBits：设置通知值的指定位。</li>
<li>eIncrement：通知值递增。</li>
<li>eSetValueWithOverwrite：覆盖通知值。</li>
<li>eSetValueWithoutOverwrite：如果通知值未处理，则不覆盖当前值。<br><strong>返回值</strong>：</li>
<li>pdPASS：操作成功。</li>
<li>pdFAIL：操作失败（通常在 eSetValueWithoutOverwrite 时发生）。</li>
</ul>
<p><strong>示例</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">xTaskNotify(xTaskHandle, <span class="hljs-number">0x01</span>, eSetBits); <span class="hljs-comment">// 设置任务通知值的第 0 位</span><br></code></pre></td></tr></table></figure>
<h4 id="xTaskNotifyGive"><a href="#xTaskNotifyGive" class="headerlink" title="xTaskNotifyGive"></a>xTaskNotifyGive</h4><p><strong>功能</strong>： 向任务发送一个 “信号量风格” 的通知，等效于 xTaskNotify() 的 eIncrement 模式。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-type">void</span> <span class="hljs-title function_">xTaskNotifyGive</span><span class="hljs-params">(TaskHandle_t xTaskToNotify)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>xTaskToNotify：接收通知的任务句柄。<br>示例：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">xTaskNotifyGive(xTaskHandle); <span class="hljs-comment">// 发送通知，通知值递增 1</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="ulTaskNotifyTake"><a href="#ulTaskNotifyTake" class="headerlink" title="ulTaskNotifyTake"></a>ulTaskNotifyTake</h4><p><strong>功能</strong>： 任务等待通知，并在接收到通知时自动减少通知值（通常用于实现计数信号量）。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">ulTaskNotifyTake</span><span class="hljs-params">(BaseType_t xClearCountOnExit, TickType_t xTicksToWait)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>xClearCountOnExit：<br>pdTRUE：退出等待时将通知值清零。<br>pdFALSE：退出等待时保留剩余通知值。</li>
<li>xTicksToWait：等待通知的时间（Tick 数，portMAX_DELAY 表示无限等待）。<br><strong>返回值</strong>：返回通知值（如果是计数信号量，表示剩余信号量计数）。</li>
</ul>
<p><strong>示例</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (ulTaskNotifyTake(pdTRUE, portMAX_DELAY) &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-comment">// 收到通知，处理任务</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="xTaskNotifyWait"><a href="#xTaskNotifyWait" class="headerlink" title="xTaskNotifyWait"></a>xTaskNotifyWait</h4><p><strong>功能</strong>： 任务等待通知，可以选择获取通知值的内容，并决定是否清除通知值。<br><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>BaseType_t <span class="hljs-title function_">xTaskNotifyWait</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-type">uint32_t</span> ulBitsToClearOnEntry,</span><br><span class="hljs-params">    <span class="hljs-type">uint32_t</span> ulBitsToClearOnExit,</span><br><span class="hljs-params">    <span class="hljs-type">uint32_t</span> *pulNotificationValue,</span><br><span class="hljs-params">    TickType_t xTicksToWait</span><br><span class="hljs-params">)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>ulBitsToClearOnEntry：进入等待时清除的通知值位。</li>
<li>ulBitsToClearOnExit：退出等待时清除的通知值位。</li>
<li>pulNotificationValue：保存通知值的指针。</li>
<li>xTicksToWait：等待时间（Tick 数）。<br><strong>返回值</strong>：</li>
<li>pdTRUE：收到通知。</li>
<li>pdFALSE：超时未收到通知。<br><strong>示例</strong>：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">uint32_t</span> ulNotificationValue;<br><span class="hljs-keyword">if</span> (xTaskNotifyWait(<span class="hljs-number">0x00</span>, <span class="hljs-number">0xFFFFFFFF</span>, &amp;ulNotificationValue, portMAX_DELAY) == pdTRUE) &#123;<br>    <span class="hljs-comment">// 收到通知，ulNotificationValue 保存通知值</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="xTaskNotifyStateClear"><a href="#xTaskNotifyStateClear" class="headerlink" title="xTaskNotifyStateClear"></a>xTaskNotifyStateClear</h4><p><strong>功能</strong>： 清除任务的通知状态（即标记任务为“未通知”）。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vTaskNotifyStateClear</span><span class="hljs-params">(TaskHandle_t xTask)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：xTask：需要清除通知状态的任务句柄。<br><strong>示例</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">vTaskNotifyStateClear(xTaskHandle); <span class="hljs-comment">// 清除通知状态</span><br></code></pre></td></tr></table></figure>

<h3 id="4-4-2-示例代码："><a href="#4-4-2-示例代码：" class="headerlink" title="4.4.2 示例代码："></a>4.4.2 示例代码：</h3><h4 id="1-直接任务通知"><a href="#1-直接任务通知" class="headerlink" title="1.直接任务通知"></a>1.直接任务通知</h4><p>由task2控制task1的运行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 事件组</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">static</span> TaskHandle_t xTask1 = <span class="hljs-literal">NULL</span>, xTask2 = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 等待task通知&quot;</span>);<br>        ulTaskNotifyTake(pdTRUE, portMAX_DELAY);<br><br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 收到task通知&quot;</span>);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task2: 发送task通知&quot;</span>);<br>        xTaskNotifyGive(xTask1);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><br>    xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, &amp;xTask1);<br>    xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, &amp;xTask2);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-任务通知值"><a href="#2-任务通知值" class="headerlink" title="2.任务通知值"></a>2.任务通知值</h4><p> 任务通知值按位判断-代替队列邮箱或者事件组</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br><span class="hljs-type">static</span> TaskHandle_t xTask1 = <span class="hljs-literal">NULL</span>, xTask2 = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br><br>    <span class="hljs-type">uint32_t</span> ulNotifiedValue;<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 等待task通知&quot;</span>);<br>        xTaskNotifyWait(<span class="hljs-number">0x00</span>, ULONG_MAX, &amp;ulNotifiedValue, portMAX_DELAY);<br>        <span class="hljs-comment">// 通过不同的bit位来判断通知的来源</span><br>        <span class="hljs-keyword">if</span> ((ulNotifiedValue &amp; <span class="hljs-number">0x01</span>) != <span class="hljs-number">0</span>)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 收到task通知-bit0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> ((ulNotifiedValue &amp; <span class="hljs-number">0x02</span>) != <span class="hljs-number">0</span>)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 收到task通知-bit1&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> ((ulNotifiedValue &amp; <span class="hljs-number">0x04</span>) != <span class="hljs-number">0</span>)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task1: 收到task通知-bit2&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task2: 发送task通知-bit0&quot;</span>);<br>        xTaskNotify(xTask1, <span class="hljs-number">0x01</span>, eSetValueWithOverwrite);<br><br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task2: 发送task通知-bit1&quot;</span>);<br>        xTaskNotify(xTask1, <span class="hljs-number">0x02</span>, eSetValueWithOverwrite);<br><br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">5000</span>));<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task2: 发送task通知-bit2&quot;</span>);<br>        xTaskNotify(xTask1, <span class="hljs-number">0x04</span>, eSetValueWithOverwrite);<br><br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><br>    xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, &amp;xTask1);<br>    xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, &amp;xTask2);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="4-5-流缓冲区和消息缓冲区"><a href="#4-5-流缓冲区和消息缓冲区" class="headerlink" title="4.5 流缓冲区和消息缓冲区"></a>4.5 流缓冲区和消息缓冲区</h2><h3 id="4-5-1-流缓冲区"><a href="#4-5-1-流缓冲区" class="headerlink" title="4.5.1 流缓冲区"></a>4.5.1 流缓冲区</h3><p>通过流缓冲区，可以将字节流从中断服务程序传递到任务， 也可以将其从一项任务传递到另一项任务。字节流可以是任意长度，不一定 有开头或结尾。可以一次写入任意数量的字节， 也可以一次读取任意数量的字节。数据通过复制的方式传递：数据由发送方复制到缓冲区中， 然后由接收方从缓冲区中读取。</p>
<h4 id="4-5-1-1-API说明"><a href="#4-5-1-1-API说明" class="headerlink" title="4.5.1.1 API说明"></a>4.5.1.1 API说明</h4><table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xStreamBufferCreate</td>
<td>创建一个流数据缓冲区</td>
<td>返回一个缓冲区句柄，供后续使用</td>
</tr>
<tr>
<td>xStreamBufferSend</td>
<td>向流缓冲区写入数据</td>
<td>如果缓冲区已满，可选择阻塞或立即返回</td>
</tr>
<tr>
<td>xStreamBufferReceive</td>
<td>从流缓冲区读取数据</td>
<td>如果缓冲区为空，可选择阻塞或立即返回</td>
</tr>
<tr>
<td>xStreamBufferReset</td>
<td>重置流缓冲区，清空所有数据</td>
<td>需确保无任务正在操作此缓冲区</td>
</tr>
<tr>
<td>xStreamBufferSpacesAvailable</td>
<td>查询缓冲区中剩余可写空间</td>
<td>返回缓冲区剩余字节数</td>
</tr>
<tr>
<td>xStreamBufferBytesAvailable</td>
<td>查询缓冲区中可读数据量</td>
<td>返回缓冲区中尚未读取的字节数</td>
</tr>
<tr>
<td>vStreamBufferDelete</td>
<td>删除流缓冲区并释放内存</td>
<td>清理操作，需在确保无任务使用的情况下执行</td>
</tr>
</tbody></table>
<p>以下是流数据缓冲区相关函数的详细说明，包含函数原型、参数解释和返回值：</p>
<h5 id="xStreamBufferCreate"><a href="#xStreamBufferCreate" class="headerlink" title="xStreamBufferCreate"></a>xStreamBufferCreate</h5><p><strong>功能</strong>： 创建一个流数据缓冲区，用于存储和传输数据。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">StreamBufferHandle_t <span class="hljs-title function_">xStreamBufferCreate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> xBufferSizeBytes, <span class="hljs-type">size_t</span> xTriggerLevelBytes)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xBufferSizeBytes</code>：缓冲区的总大小（以字节为单位）。</li>
<li><code>xTriggerLevelBytes</code>：触发读取任务的最小字节数（推荐设为 1）。</li>
</ul>
<p><strong>返回值</strong>：</p>
<p>成功：返回创建的流缓冲区句柄。<br>失败：返回 NULL。</p>
<h5 id="xStreamBufferSend"><a href="#xStreamBufferSend" class="headerlink" title="xStreamBufferSend"></a>xStreamBufferSend</h5><p><strong>功能</strong>： 向流缓冲区写入数据。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">xStreamBufferSend</span><span class="hljs-params">(StreamBufferHandle_t xStreamBuffer, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *pvTxData, <span class="hljs-type">size_t</span> xDataLengthBytes, TickType_t xTicksToWait)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xStreamBuffer</code>：目标流缓冲区的句柄。</li>
<li><code>pvTxData</code>：指向要写入数据的指针。</li>
<li><code>xDataLengthBytes</code>：要写入的数据长度（字节数）。</li>
<li><code>xTicksToWait</code>：写入时的最大阻塞时间（Tick 数，0 表示立即返回）。</li>
</ul>
<p><strong>返回值</strong>：</p>
<p>成功：实际写入的字节数。<br>失败：0 表示写入失败（缓冲区已满）。</p>
<h5 id="xStreamBufferReceive"><a href="#xStreamBufferReceive" class="headerlink" title="xStreamBufferReceive"></a>xStreamBufferReceive</h5><p><strong>功能</strong>： 从流缓冲区中读取数据。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-type">size_t</span> <span class="hljs-title function_">xStreamBufferReceive</span><span class="hljs-params">(StreamBufferHandle_t xStreamBuffer, <span class="hljs-type">void</span> *pvRxData, <span class="hljs-type">size_t</span> xBufferLengthBytes, TickType_t xTicksToWait)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xStreamBuffer</code>：目标流缓冲区的句柄。</li>
<li><code>pvRxData</code>：指向接收数据的缓冲区指针。</li>
<li><code>xBufferLengthBytes</code>：接收缓冲区的大小（字节数）。</li>
<li><code>xTicksToWait</code>：读取时的最大阻塞时间（Tick 数，0 表示立即返回）。</li>
</ul>
<p><strong>返回值</strong>：</p>
<p>成功：实际读取的字节数。<br>失败：0 表示读取失败（缓冲区为空）。</p>
<h5 id="xStreamBufferReset"><a href="#xStreamBufferReset" class="headerlink" title="xStreamBufferReset"></a>xStreamBufferReset</h5><p><strong>功能</strong>： 重置流缓冲区，清空所有数据。<br><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xStreamBufferReset</span><span class="hljs-params">(StreamBufferHandle_t xStreamBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xStreamBuffer</code>：目标流缓冲区的句柄。<br><strong>返回值</strong>：</li>
<li><code>pdPASS</code>：重置成功。</li>
<li><code>pdFAIL</code>：重置失败（通常是因为缓冲区正在被任务或中断使用）。</li>
</ul>
<h5 id="xStreamBufferSpacesAvailable"><a href="#xStreamBufferSpacesAvailable" class="headerlink" title="xStreamBufferSpacesAvailable"></a>xStreamBufferSpacesAvailable</h5><p><strong>功能</strong>： 查询流缓冲区中剩余的可写空间。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-type">size_t</span> <span class="hljs-title function_">xStreamBufferSpacesAvailable</span><span class="hljs-params">(StreamBufferHandle_t xStreamBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>xStreamBuffer：目标流缓冲区的句柄。<br><strong>返回值</strong>：剩余可写空间的字节数。</li>
</ul>
<h5 id="xStreamBufferBytesAvailable"><a href="#xStreamBufferBytesAvailable" class="headerlink" title="xStreamBufferBytesAvailable"></a>xStreamBufferBytesAvailable</h5><p><strong>功能</strong>： 查询流缓冲区中可读取的数据量。<br><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">xStreamBufferBytesAvailable</span><span class="hljs-params">(StreamBufferHandle_t xStreamBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xStreamBuffer</code>：目标流缓冲区的句柄。<br><strong>返回值</strong>：当前缓冲区中可读取的数据字节数。</li>
</ul>
<h5 id="vStreamBufferDelete"><a href="#vStreamBufferDelete" class="headerlink" title="vStreamBufferDelete"></a>vStreamBufferDelete</h5><p><strong>功能</strong>： 删除一个流缓冲区并释放其内存。<br><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-type">void</span> <span class="hljs-title function_">vStreamBufferDelete</span><span class="hljs-params">(StreamBufferHandle_t xStreamBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xStreamBuffer</code>：目标流缓冲区的句柄。<br>返回值：无返回值。</li>
</ul>
<h4 id="4-5-1-2-示例代码"><a href="#4-5-1-2-示例代码" class="headerlink" title="4.5.1.2 示例代码"></a>4.5.1.2 示例代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 任务通知值按位判断-代替队列邮箱或者事件组</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/stream_buffer.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br>StreamBufferHandle_t xStreamBuffer;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br><br>    <span class="hljs-type">char</span> tx_buf[<span class="hljs-number">50</span>];<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        i++;<br>        <span class="hljs-built_in">sprintf</span>(tx_buf, <span class="hljs-string">&quot;Hello World!-%d&quot;</span>, i);<br>        <span class="hljs-comment">// 写入数据到流缓冲区</span><br>        <span class="hljs-type">int</span> send_len = xStreamBufferSend(xStreamBuffer, (<span class="hljs-type">void</span> *)tx_buf, <span class="hljs-keyword">sizeof</span>(tx_buf), portMAX_DELAY);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1发送数据长度: %d&quot;</span>, send_len);<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br>    <span class="hljs-type">char</span> rx_buf[<span class="hljs-number">50</span>];<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">memset</span>(rx_buf, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(rx_buf));<br>        <span class="hljs-comment">// 读取数据</span><br>        <span class="hljs-type">int</span> recv_len = xStreamBufferReceive(xStreamBuffer, (<span class="hljs-type">void</span> *)rx_buf, <span class="hljs-keyword">sizeof</span>(rx_buf), portMAX_DELAY);<br>        <span class="hljs-keyword">if</span> (recv_len &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            rx_buf[recv_len] = <span class="hljs-number">0</span>;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task2接收数据: %s &quot;</span>, rx_buf);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 监控缓冲区</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">task3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">// 读取数据</span><br>        <span class="hljs-type">size_t</span> xBytesAvailable = xStreamBufferBytesAvailable(xStreamBuffer);<br>        <span class="hljs-keyword">if</span> (xBytesAvailable &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;监控缓冲区中有数据: %d&quot;</span>, xBytesAvailable);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;监控缓冲区中无数据&quot;</span>);<br>        &#125;<br>        vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>    &#125;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    xStreamBuffer = xStreamBufferCreate(<span class="hljs-number">1024</span>, <span class="hljs-number">300</span>); <span class="hljs-comment">// 创建一个 1024 字节的流缓冲区，每次可读取 1 字节</span><br>    <span class="hljs-keyword">if</span> (xStreamBuffer != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;创建流缓冲区成功&quot;</span>);<br>        xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(task3, <span class="hljs-string">&quot;task3&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;创建流缓冲区失败&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="4-5-2-消息缓冲区"><a href="#4-5-2-消息缓冲区" class="headerlink" title="4.5.2 消息缓冲区"></a>4.5.2 消息缓冲区</h3><p>消息缓冲区允许长度可变的离散消息从中断服务程序传递至 一个任务，或从一个任务传递至另一个任务。例如，长度为 10、20 和 123 字节的消息 都可以在同一个消息缓冲区写入或读取 。与使用流缓冲区不同的是， 长度为 10 个字节的消息只能作为 10 个字节的消息读取，而不能 以单独的字节读取。消息缓冲区构建在流缓冲区之上（即它们使用 流缓冲区实现）。</p>
<h4 id="4-6-1-API说明"><a href="#4-6-1-API说明" class="headerlink" title="4.6.1 API说明"></a>4.6.1 API说明</h4><p>以下是消息缓冲区的核心 API，以及其功能和参数说明。</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xMessageBufferCreate</td>
<td>创建一个消息缓冲区</td>
<td>返回一个缓冲区句柄，供后续使用</td>
</tr>
<tr>
<td>xMessageBufferSend</td>
<td>向消息缓冲区写入数据</td>
<td>如果缓冲区空间不足，可选择阻塞或立即返回</td>
</tr>
<tr>
<td>xMessageBufferReceive</td>
<td>从消息缓冲区读取数据</td>
<td>如果缓冲区为空，可选择阻塞或立即返回</td>
</tr>
<tr>
<td>xMessageBufferSpaceAvailable</td>
<td>查询消息缓冲区中剩余可用空间</td>
<td>返回剩余字节数</td>
</tr>
<tr>
<td>xMessageBufferReset</td>
<td>重置消息缓冲区，清空所有数据</td>
<td>需确保没有任务正在操作缓冲区</td>
</tr>
<tr>
<td>vMessageBufferDelete</td>
<td>删除消息缓冲区并释放内存</td>
<td>必须在没有任务使用此缓冲区的情况下执行</td>
</tr>
</tbody></table>
<h5 id="xMessageBufferCreate"><a href="#xMessageBufferCreate" class="headerlink" title="xMessageBufferCreate"></a>xMessageBufferCreate</h5><p><strong>功能</strong>： 创建一个消息缓冲区，用于传输带长度前缀的消息。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">MessageBufferHandle_t <span class="hljs-title function_">xMessageBufferCreate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> xBufferSizeBytes)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li><code>xBufferSizeBytes</code>：缓冲区的总大小（字节）。</li>
</ul>
<p><strong>返回值</strong>：</p>
<p>成功：返回创建的消息缓冲区句柄。<br>失败：返回 NULL。</p>
<h5 id="xMessageBufferSend"><a href="#xMessageBufferSend" class="headerlink" title="xMessageBufferSend"></a>xMessageBufferSend</h5><p><strong>功能</strong>： 向消息缓冲区中写入数据。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">xMessageBufferSend</span><span class="hljs-params">(MessageBufferHandle_t xMessageBuffer, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *pvTxData, <span class="hljs-type">size_t</span> xDataLengthBytes, TickType_t xTicksToWait)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>参数</strong>：</p>
<ul>
<li>xMessageBuffer：目标消息缓冲区的句柄。</li>
<li>pvTxData：指向要写入数据的指针。</li>
<li>xDataLengthBytes：要写入的数据长度（字节）。</li>
<li>xTicksToWait：写入时的最大阻塞时间（Tick 数，0 表示立即返回）。</li>
</ul>
<p><strong>返回值</strong>：</p>
<ul>
<li>成功：实际写入的字节数。</li>
<li>失败：0 表示写入失败（缓冲区空间不足）。</li>
</ul>
<h5 id="xMessageBufferReceive"><a href="#xMessageBufferReceive" class="headerlink" title="xMessageBufferReceive"></a>xMessageBufferReceive</h5><p><strong>功能</strong>： 从消息缓冲区中读取数据。<br><strong>原型：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">xMessageBufferReceive</span><span class="hljs-params">(MessageBufferHandle_t xMessageBuffer, <span class="hljs-type">void</span> *pvRxData, <span class="hljs-type">size_t</span> xBufferLengthBytes, TickType_t xTicksToWait)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>xMessageBuffer：目标消息缓冲区的句柄。</li>
<li>pvRxData：指向接收数据的缓冲区指针。</li>
<li>xBufferLengthBytes：接收缓冲区的大小（字节）。</li>
<li>xTicksToWait：读取时的最大阻塞时间（Tick 数，0 表示立即返回）。</li>
</ul>
<p><strong>返回值</strong>：</p>
<ul>
<li>成功：实际读取的字节数。</li>
<li>失败：0 表示读取失败（缓冲区为空）。</li>
</ul>
<blockquote>
<p>注意，当接收缓冲区小于消息长度时，无法接收到消息。</p>
</blockquote>
<h5 id="xMessageBufferSpaceAvailable"><a href="#xMessageBufferSpaceAvailable" class="headerlink" title="xMessageBufferSpaceAvailable"></a>xMessageBufferSpaceAvailable</h5><p><strong>功能</strong>： 查询消息缓冲区中剩余的可用空间。<br><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">xMessageBufferSpaceAvailable</span><span class="hljs-params">(MessageBufferHandle_t xMessageBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：</p>
<ul>
<li>xMessageBuffer：目标消息缓冲区的句柄。<br><strong>返回值</strong>：剩余可用空间的字节数。</li>
</ul>
<h5 id="xMessageBufferReset"><a href="#xMessageBufferReset" class="headerlink" title="xMessageBufferReset"></a>xMessageBufferReset</h5><p><strong>功能</strong>： 重置消息缓冲区，清空所有数据。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>BaseType_t <span class="hljs-title function_">xMessageBufferReset</span><span class="hljs-params">(MessageBufferHandle_t xMessageBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：- xMessageBuffer：目标消息缓冲区的句柄。<br><strong>返回值</strong>：</p>
<ul>
<li>pdPASS：重置成功。</li>
<li>pdFAIL：重置失败（缓冲区正在被使用）。</li>
</ul>
<h5 id="vMessageBufferDelete"><a href="#vMessageBufferDelete" class="headerlink" title="vMessageBufferDelete"></a>vMessageBufferDelete</h5><p><strong>功能</strong>： 删除一个消息缓冲区并释放其内存。</p>
<p><strong>原型</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vMessageBufferDelete</span><span class="hljs-params">(MessageBufferHandle_t xMessageBuffer)</span>;<br></code></pre></td></tr></table></figure>
<p><strong>参数</strong>：xMessageBuffer：目标消息缓冲区的句柄。</p>
<p><strong>返回值</strong>：无返回值。</p>
<h4 id="4-6-2-示例代码"><a href="#4-6-2-示例代码" class="headerlink" title="4.6.2 示例代码"></a>4.6.2 示例代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 任务通知值按位判断-代替队列邮箱或者事件组</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;esp_log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;freertos/message_buffer.h&quot;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">&quot;main&quot;</span>;<br><br>MessageBufferHandle_t xMessageBuffer;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task1启动!&quot;</span>);<br><br>    <span class="hljs-type">char</span> tx_buf[<span class="hljs-number">50</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)<br>    &#123;<br>        <span class="hljs-built_in">sprintf</span>(tx_buf, <span class="hljs-string">&quot;Hello World!-%d&quot;</span>, i);<br>        <span class="hljs-comment">// 写入数据到流缓冲区</span><br>        <span class="hljs-type">int</span> send_len = xMessageBufferSend(xMessageBuffer, (<span class="hljs-type">void</span> *)tx_buf, <span class="hljs-keyword">sizeof</span>(tx_buf), portMAX_DELAY);<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;task1发送数据长度: %d&quot;</span>, send_len);<br>    &#125;<br><br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span><br>&#123;<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>    ESP_LOGI(TAG, <span class="hljs-string">&quot;task2启动!&quot;</span>);<br>    <span class="hljs-type">char</span> rx_buf[<span class="hljs-number">200</span>];<br>    vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">3000</span>));<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">memset</span>(rx_buf, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(rx_buf));<br>        <span class="hljs-comment">// 读取数据</span><br>        <span class="hljs-type">int</span> recv_len = xMessageBufferReceive(xMessageBuffer, (<span class="hljs-type">void</span> *)rx_buf, <span class="hljs-keyword">sizeof</span>(rx_buf), portMAX_DELAY);<br>        <span class="hljs-keyword">if</span> (recv_len &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            rx_buf[recv_len] = <span class="hljs-number">0</span>;<br>            ESP_LOGI(TAG, <span class="hljs-string">&quot;task2接收数据: %s &quot;</span>, rx_buf);<br>            vTaskDelay(pdMS_TO_TICKS(<span class="hljs-number">1000</span>));<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">app_main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    xMessageBuffer = xMessageBufferCreate(<span class="hljs-number">1024</span>); <span class="hljs-comment">// 创建消息缓冲区</span><br>    <span class="hljs-keyword">if</span> (xMessageBuffer != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;创建消息缓冲区成功&quot;</span>);<br>        xTaskCreate(task1, <span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>        xTaskCreate(task2, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ESP_LOGI(TAG, <span class="hljs-string">&quot;创建流缓冲区失败&quot;</span>);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h1 id="五、其他高级功能"><a href="#五、其他高级功能" class="headerlink" title="五、其他高级功能"></a>五、其他高级功能</h1><p>暂无</p>
<h1 id="六、代码风格约定"><a href="#六、代码风格约定" class="headerlink" title="六、代码风格约定"></a>六、代码风格约定</h1><h2 id="6-1-命名惯例"><a href="#6-1-命名惯例" class="headerlink" title="6.1 命名惯例"></a>6.1 命名惯例</h2><p>RTOS 内核和演示应用程序源代码使用以下惯例:</p>
<p><strong>变量</strong>：</p>
<ul>
<li>uint32_t 类型变量以 ul 为前缀，其中“u”表示“unsigned” ，“l”表示“long”。</li>
<li>uint16_t 类型变量以 us 为前缀，其中“u”表示“unsigned” ，“s”表示“short”。</li>
<li>uint8_t 类型变量以 uc 为前缀，其中“u”表示“unsigned” ，“c”表示“char ”。</li>
<li>非 stdint 类型的变量以 x 为前缀。例如，BaseType_t 和 TickType_t， 二者分别是可移植层定义的定义类型，主要架构的自然类型或最有效类型， 以及用于保存 RTOS 滴答计数的类型。</li>
<li>非 stdint 类型的未签名变量存在附加前缀 u。例如， UBaseType_t（未签名 BaseType_t）类型变量以 ux 为前缀。</li>
<li>size_t 类型变量也带有 ux 前缀。</li>
<li>枚举变量以 e 为前缀</li>
<li>指针以附加 p 为前缀，例如，指向 uint16_t 的指针将以 pus 为前缀。</li>
<li>根据 MISRA 指南，未限定标准 char 类型仅可包含 ASCII 字符， 并以 c 为前缀。</li>
<li>根据 MISRA 指南，<code>*char **</code> 类型变量仅可包含指向 ASCII 字符串的指针， 并以 pc 为前缀。</li>
</ul>
<p><strong>函数</strong>：</p>
<ul>
<li>文件作用域静态（私有）函数以 prv 为前缀。</li>
<li>根据变量定义的相关规定，API 函数以其返回类型为前缀， 并为 void 添加前缀 v。</li>
<li>API 函数名称以定义 API 函数文件的名称开头。例如，在 tasks.c 中定义 vTaskDelete， 并且具有 void 返回类型。</li>
</ul>
<p><strong>宏</strong>：</p>
<ul>
<li>宏以定义宏的文件为前缀。前缀为小写。例如， configUSE_PREEMPTION 在 FreeRTOSConfig.h 中定义。</li>
<li>除前缀外，所有宏均使用大写字母书写，并使用下划线来分隔单词。</li>
</ul>
<h2 id="6-2-数据类型"><a href="#6-2-数据类型" class="headerlink" title="6.2 数据类型"></a>6.2 数据类型</h2><p><strong>仅使用 stdint.h 类型和 RTOS 自带的 typedef，但以下情况除外：</strong></p>
<ul>
<li><code>char</code>：<br>根据 MISRA 指南，仅在未限定字符类型包含 ASCII 字符方可使用未限定字符类型。</li>
<li><code>char *</code>:<br>根据 MISRA 指南，仅在未限定字符指针指向 ASCII 字符串时方可使用未限定字符指针 。使用需要 char * 参数的标准库函数时， 无需抑制良性编译器警告，此举尤其考虑到将一些编译器默认为未限定 char 类型是签名的， 而其他编译器默认未限定 char 类型是未签名的。</li>
</ul>
<p><strong>针对每个移植定义四种类型。即：</strong></p>
<ul>
<li><code>TickType_t</code><br>如果 configUSE_16_BIT_TICKS 设置为非零 (true) ，则将 TickType_t 定义为未签名的 16 位类型。<br>如果 configUSE_16_BIT_TICKS 设置为零 (false)，则将 TickType_t 定义为未签名的 32 位类型。<br>32 位架构应始终将 configUSE_16_BIT_TICKS 设置为 0。</li>
<li><code>BaseType_t</code><br>架构中最有效、最自然的类型。例如，在 32 位架构上， BaseType_t 会被定义为 32 位类型。在 16 位架构上，BaseType_t 会被定义为 16 位类型 。如果将 BaseType_t 定义为 char， 则须特别注意确保将签名字符用于可能为负的函数返回值来指示错误。</li>
<li><code>UBaseType_t</code><br>未签名的 BaseType_t。</li>
<li><code>StackType_t</code><br>意指架构用于存储堆栈项目的类型。通常是 16 位架构上的 16 位类型 和 32 位架构上的 32 位类型，但也有例外情况。供 FreeRTOS 内部使用。</li>
</ul>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.freertos.org/zh-cn-cmn-s">https://www.freertos.org/zh-cn-cmn-s</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1fs4y1G7eu/?spm_id_from=333.999.top_right_bar_window_history.content.click&vd_source=ef5a0ab0106372751602034cdd9ab98e">https://www.bilibili.com/video/BV1fs4y1G7eu/?spm_id_from=333.999.top_right_bar_window_history.content.click&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43321489/article/details/107939188">https://blog.csdn.net/weixin_43321489/article/details/107939188</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/chengjunchengjun/article/details/109710929">https://blog.csdn.net/chengjunchengjun/article/details/109710929</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%BD%AF%E4%BB%B6%E7%9B%B8%E5%85%B3/" class="category-chain-item">软件相关</a>
  
  
    <span>></span>
    
  <a href="/categories/%E8%BD%AF%E4%BB%B6%E7%9B%B8%E5%85%B3/FreeRTOS/" class="category-chain-item">FreeRTOS</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/FreeRTOS/" class="print-no-link">#FreeRTOS</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>FreeRTOS复习笔记</div>
      <div>https://www.duruofu.xyz/posts/58683/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>DuRuofu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年12月30日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2025年1月11日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/58875/" title="ESP32从初见到入门-大纲(2025)">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ESP32从初见到入门-大纲(2025)</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/3722/" title="ESP32GUI入门-使用SquareLine_Studio设计LVGL页面">
                        <span class="hidden-mobile">ESP32GUI入门-使用SquareLine_Studio设计LVGL页面</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"c9ac06d5413a9d613a1e","clientSecret":"a44f5c72589eb090876cc64067db28fbfdf4747c","repo":"Blog-comments-gitalk","owner":"DuRuofu","admin":["DuRuofu"],"language":"zh-CN","labels":["Gitalk"],"perPage":15,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":false,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: 'bf465beaf8dd53313c3ef0e413d17363'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <br><span id="timeDate">天数载入中</span><span id="times">...</span><br> <p>Copyright © 2023 - <span id="currentYear"></span> DuRuofu.All Rights Reserved.</p>
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
    <!-- 备案信息 ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      陕ICP备2022007454号
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=2022007454"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>陕ICP备2022007454号-2</span>
        </a>
      </span>
    
  
</div>

  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":true,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  var relativeDate = function() {
    var updatedTime = document.getElementById('updated-time');
    if (updatedTime) {
      var text = updatedTime.textContent;
      var reg = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/;
      var matchs = text.match(reg);
      if (matchs) {
        var relativeTime = moment(matchs[0]).fromNow();
        updatedTime.textContent = text.replace(reg, relativeTime);
      }
      updatedTime.style.display = '';
    }
  };
  Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/moment.min.js', function() {
    if (!'zh-cn'.startsWith('en')) {
      Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/locale/zh-cn.min.js', function() {
        relativeDate();
      });
    } else {
      relativeDate();
    }
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/cust/custom.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
